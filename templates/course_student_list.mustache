<!--Instructions row-->
<input type="hidden" id="early-alert-student-ids">
<input type="hidden" id="early-alert-template-cache" value="{{templates}}">
<input type="hidden" id="early-alert-hascustommessage" value="{{hascustommessage}}">
<div class="row">
    <div class="col">
        <h3>{{#str}}selected_alert_based_on, local_earlyalert{{/str}} <span class="text-danger">{{alert_type}}</span> for {{fullname}}</h3>

        {{#grade}}
            <p>{{#str}}grade_instructions, local_earlyalert{{/str}}</p>
            <div class="d-flex align-items-center mb-2">
                <div class="mr-3 ml-4">
                    <b>{{#str}}adjust_default_grade, local_earlyalert{{/str}}: </b>
                    <select id="id_early_alert_filter_grade_select"
                            name="early_alert_filter_grade_select"
                            style="width: 50px;"
                            data-initial-value="9">
                        <option value="11">F</option>
                        <option value="10">D</option>
                        <option value="9">D+</option>
                        <option value="8">C-</option>
                        <option value="7">C</option>
                        <option value="6">C+</option>
                        <option value="5">B-</option>
                        <option value="4">B</option>
                        <option value="3">B+</option>
                        <option value="2">A-</option>
                        <option value="1">A</option>
                    </select>
                </div>
                <div>
                    <span class="custom-message-preview text-muted font-italic mr-2"></span>
                    {{#hascustommessage}}
                    <button type="button" id="toggle-custom-message" class="btn btn-sm btn-outline-secondary"
                            data-toggle="collapse" data-target="#custom-message-container"
                            aria-expanded="false" aria-controls="custom-message-container">
                        <i class="fa fa-plus"></i>  {{#str}}custom_message_button_label, local_earlyalert{{/str}}
                    </button>
                    {{/hascustommessage}}
                </div>
                <p>{{#str}}no_gradebook_instructions, local_earlyalert{{/str}}</p>
                    <div class="form-check">
                        <input class="early-alert-student-checkbox" type="checkbox" value="" id="early-alert-not-using-gradebook-checkbox">
                        <label class="form-check-label" for="early-alert-not-using-gradebook-checkbox">
                            {{#str}}not_using_gradebook, local_earlyalert{{/str}}
                        </label>
                    </div>
            </div>
        {{/grade}}

        {{#assign}}
            <p>{{#str}}assignment_instructions, local_earlyalert{{/str}}</p>
            <div class="mb-5 ml-4">
                <div class="d-flex align-items-center">
                    <p class="mb-0 mr-2"><b>{{#str}}assignment_title, local_earlyalert{{/str}}:</b></p>
                    <input type="text" id="early-alert-assignment-title" class="form-control" style="max-width: 320px;"
                           placeholder="Enter the assignment title (required)" required/>
                </div>
                <small id="assignment-title-error" class="text-danger d-block mt-1" style="display: none;">
                    {{#str}}assignment_title_required, local_earlyalert{{/str}}
                </small>
            </div>
        {{/assign}}

        {{#exam}}
            <p>{{#str}}exam_instructions, local_earlyalert{{/str}}</p>
        {{/exam}}
        {{^grade}}
            <div class="mb-3">
                <span class="custom-message-preview text-muted font-italic mr-2"></span>
                {{#hascustommessage}}
                <button type="button" id="toggle-custom-message" class="btn btn-sm btn-outline-secondary"
                        data-toggle="collapse" data-target="#custom-message-container"
                        aria-expanded="false" aria-controls="custom-message-container">
                    <i class="fa fa-plus"></i> Show Custom Message
                </button>
                {{/hascustommessage}}
            </div>
        {{/grade}}
        <!-- Unified collapsible custom message container (shared by all alert types) -->
        {{#hascustommessage}}
        <div id="custom-message-container" class="custom-message-container collapse mb-3 ">
            <textarea id="early-alert-custom-message" class="form-control early-alert-custom-message" rows="4"
                      placeholder="Enter a custom message to be included in all emails. This will replace [custommessage] in the template."></textarea>
            <small class="form-text text-muted">This message will be added to all selected student emails.</small>
        </div>
        {{/hascustommessage}}
    </div>
</div>

<div class="row mt-2">
    <div class="col">
        <h3>{{#str}}my_list_of_students, local_earlyalert{{/str}}</h3>
        <p>{{#str}}select_students, local_earlyalert, {{alert_type}} {{/str}}</p>
        <p>
            <input type="checkbox" id="early-alert-checkall-student-checkbox" class="early-alert-checkall-student-checkbox"> All/None
            <button id="early-alert-send-button1" class="btn btn-primary ml-2 early-alert-send-button">Send</button>
        </p>
    </div>
</div>

<!--Student list row-->
<div class="row">
    {{#student_rows}}
        <div class="col">
            <table class="table table-striped table-hover table-sm">
                <thead>
                <tr>
                    <th scope="col"></th>
                    <th scope="col">{{#str}}name, local_earlyalert{{/str}}</th>
                    <th scope="col" class="early-alert-grade-column">{{#str}}grade, local_earlyalert{{/str}}</th>
                    <th scope="col"></th>
                </tr>
                </thead>
                <tbody>
                {{#students}}
                    <tr>
                        <td><input type="checkbox" class="early-alert-student-checkbox"
                                   data-teacher-firstname="{{teacher_firstname}}"
                                   data-teacher-lastname="{{teacher_lastname}}"
                                   data-teacher-email="{{teacher_email}}"
                                   data-student-id="{{id}}"
                                   data-student-idnumber="{{idnumber}}"
                                   data-student-campus="{{campus}}"
                                   data-student-lang="{{lang}}"
                                   data-student-faculty="{{faculty}}"
                                   data-student-major="{{major}}"
                                   data-courseid="{{courseid}}"></td>
                        <td>{{last_name}}, {{first_name}}<br>{{idnumber}}</td>
                        <td class="early-alert-grade-column"><span class="badge badge-primary">{{grade}}</span></td>
                        <td>
                            <button class="btn btn-outline-primary btn-sm early-alert-preview-button">{{#str}}preview, local_earlyalert{{/str}}</button>
                        </td>
                    </tr>
                {{/students}}
                </tbody>
            </table>
        </div>
    {{/student_rows}}
</div>
<div>
    <button id="early-alert-send-button2" class="btn btn-primary float-right early-alert-send-button">Send</button>
</div>
