{"version":3,"file":"select_box.min.js","sources":["../src/select_box.js"],"sourcesContent":["// File: amd/src/select_box.js\nimport ajax from 'core/ajax';\nimport {get_string as getString} from 'core/str';\n\nconst selectBox = {\n    init: function(selector, method, placeholder) {\n        const selectElement = document.querySelector(selector);\n        if (!selectElement) return;\n\n        const searchInput = document.createElement('input');\n        searchInput.type = 'text';\n        searchInput.placeholder = placeholder;\n\n        // Add class form-control to the search input\n        searchInput.classList.add('form-control');\n        searchInput.style.display = 'none'; // Initially hide the search input\n        selectElement.parentNode.insertBefore(searchInput, selectElement.nextSibling);\n\n        selectElement.addEventListener('click', function () {\n            searchInput.style.display = 'block'; // Show the search input when the select element is clicked\n            // Focus the search input\n            searchInput.focus();\n        });\n        // add <option value=\"\">Select a user</option> to the selectElement\n        const opt = document.createElement('option');\n        opt.value = '';\n        opt.textContent = placeholder;\n        searchInput.addEventListener('input', function () {\n            const searchTerm = searchInput.value || \"\";\n            if (searchTerm.length < 3) return; // Minimum 3 characters to search\n\n            ajax.call([{\n                methodname: method,\n                args: {search: searchTerm},\n                done: function (response) {\n                    updateOptions(selectElement, response);\n                },\n                fail: function (error) {\n                    console.error(error);\n                }\n            }]);\n        });\n\n        function updateOptions(select, options) {\n            // If multiple attribute is set, and a or multiple options are selected, do not clear the options\n            if (select.hasAttribute('multiple')) {\n                // Are options slected?\n                if (select.selectedOptions.length > 0) {\n                    // do nothing\n                } else {\n                    select.innerHTML = '';\n                }\n            } else {\n                select.innerHTML = 'test';\n                select.appendChild(opt);\n            }\n\n            select.appendChild(opt);\n            // Open the options list\n            select.size = options.length + 2;\n\n            options.forEach(option => {\n\n                const opt = document.createElement('option');\n                opt.value = option.value;\n                opt.textContent = option.label;\n                select.appendChild(opt);\n            });\n        }\n\n        // Helper: update label with selected option\n        function updateLabelWithSelectedOption() {\n            const label = selectElement.labels[0];\n            if (label && selectElement.selectedIndex > 0) {\n                const selectedText = selectElement.options[selectElement.selectedIndex].textContent;\n                getString('impersonate_user', 'local_earlyalert', selectedText).then(function(labelText) { // Use getString to translate the label text and resolve it\n                    label.textContent = labelText;\n                    console.log('resolved label text:', labelText);\n                });\n            }\n        }\n\n        if (selectElement.hasAttribute('multiple')) {\n            selectElement.addEventListener('change', function () {\n                const selectedOptions = Array.from(selectElement.selectedOptions).map(opt => opt.value);\n                // updateLabelWithSelectedOption();\n            });\n        } else {\n            // Add change event for single select to reload page with user_id\n            selectElement.addEventListener('change', function () {\n                const selectedUserId = selectElement.value;\n                //updateLabelWithSelectedOption();\n                if (selectedUserId) {\n                    // Reload the page with user_id as a query parameter\n                    const url = new URL(window.location.href);\n                    url.searchParams.set('user_id', selectedUserId);\n                    // Remove course_id if present, so course list refreshes\n                    url.searchParams.delete('course_id');\n                    window.location.href = url.toString();\n                }\n            });\n        }\n\n        // On page load, update label if a user is already selected\n        updateLabelWithSelectedOption();\n    }\n};\n\nexport default selectBox;\n\n"],"names":["init","selector","method","placeholder","selectElement","document","querySelector","searchInput","createElement","type","classList","add","style","display","parentNode","insertBefore","nextSibling","addEventListener","focus","opt","value","textContent","searchTerm","length","call","methodname","args","search","done","response","select","options","hasAttribute","selectedOptions","innerHTML","appendChild","size","forEach","option","label","updateOptions","fail","error","console","Array","from","map","selectedUserId","url","URL","window","location","href","searchParams","set","delete","toString","labels","selectedIndex","selectedText","then","labelText","log","updateLabelWithSelectedOption"],"mappings":"gQAIkB,CACdA,KAAM,SAASC,SAAUC,OAAQC,mBACvBC,cAAgBC,SAASC,cAAcL,cACxCG,cAAe,aAEdG,YAAcF,SAASG,cAAc,SAC3CD,YAAYE,KAAO,OACnBF,YAAYJ,YAAcA,YAG1BI,YAAYG,UAAUC,IAAI,gBAC1BJ,YAAYK,MAAMC,QAAU,OAC5BT,cAAcU,WAAWC,aAAaR,YAAaH,cAAcY,aAEjEZ,cAAca,iBAAiB,SAAS,WACpCV,YAAYK,MAAMC,QAAU,QAE5BN,YAAYW,iBAGVC,IAAMd,SAASG,cAAc,UACnCW,IAAIC,MAAQ,GACZD,IAAIE,YAAclB,YAClBI,YAAYU,iBAAiB,SAAS,iBAC5BK,WAAaf,YAAYa,OAAS,GACpCE,WAAWC,OAAS,iBAEnBC,KAAK,CAAC,CACPC,WAAYvB,OACZwB,KAAM,CAACC,OAAQL,YACfM,KAAM,SAAUC,oBASDC,OAAQC,SAEvBD,OAAOE,aAAa,YAEhBF,OAAOG,gBAAgBV,OAAS,IAGhCO,OAAOI,UAAY,KAGvBJ,OAAOI,UAAY,OACnBJ,OAAOK,YAAYhB,MAGvBW,OAAOK,YAAYhB,KAEnBW,OAAOM,KAAOL,QAAQR,OAAS,EAE/BQ,QAAQM,SAAQC,eAENnB,IAAMd,SAASG,cAAc,UACnCW,IAAIC,MAAQkB,OAAOlB,MACnBD,IAAIE,YAAciB,OAAOC,MACzBT,OAAOK,YAAYhB,QA/BfqB,CAAcpC,cAAeyB,WAEjCY,KAAM,SAAUC,OACZC,QAAQD,MAAMA,cA4CtBtC,cAAc4B,aAAa,YAC3B5B,cAAca,iBAAiB,UAAU,WACb2B,MAAMC,KAAKzC,cAAc6B,iBAAiBa,KAAI3B,KAAOA,IAAIC,WAKrFhB,cAAca,iBAAiB,UAAU,iBAC/B8B,eAAiB3C,cAAcgB,SAEjC2B,eAAgB,OAEVC,IAAM,IAAIC,IAAIC,OAAOC,SAASC,MACpCJ,IAAIK,aAAaC,IAAI,UAAWP,gBAEhCC,IAAIK,aAAaE,OAAO,aACxBL,OAAOC,SAASC,KAAOJ,IAAIQ,gCA1B7BjB,MAAQnC,cAAcqD,OAAO,MAC/BlB,OAASnC,cAAcsD,cAAgB,EAAG,OACpCC,aAAevD,cAAc2B,QAAQ3B,cAAcsD,eAAerC,gCAC9D,mBAAoB,mBAAoBsC,cAAcC,MAAK,SAASC,WAC1EtB,MAAMlB,YAAcwC,UACpBlB,QAAQmB,IAAI,uBAAwBD,eA2BhDE"}