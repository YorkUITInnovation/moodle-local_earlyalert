{"version":3,"file":"filter_students_grade.min.js","sources":["../src/filter_students_grade.js"],"sourcesContent":["import ajax from 'core/ajax';\nimport Templates from 'core/templates';\nimport ModalFactory from 'core/modal_factory';\nimport {get_string as getString} from 'core/str';\nimport notification from 'core/notification';\nimport {get_format as formatString} from 'core/str';\n\nexport const init = () => {\n    alert_type_button();\n    get_users();\n};\n\nfunction alert_type_button() {\n    // Get data-link when .early-alert-type-button link is clicked\n    document.addEventListener('click', function (event) {\n        if (event.target.classList.contains('early-alert-type-button')) {\n            let alert_type = event.target.getAttribute('data-link');\n            let course_name = event.target.getAttribute('data-name');\n            let course_id = event.target.getAttribute('data-course_id');\n            let teacher_user_id = document.getElementById('early-alert-teacher-user-id').value;\n            console.log('teacher_user_id:', teacher_user_id);\n            // Get student list based on alert type\n            setup_filter_students_by_grade(course_id, 9, course_name, alert_type,teacher_user_id);\n        }\n    });\n}\n\n\n/**\n * Adds students with grades\n */\n// function filter_students_by_default_grade() {\n//\n//     // Get course id from the hidden input field wiht id early_alert_filter_course_id\n//     const course_id = document.getElementById('early_alert_filter_course_id').value;\n//     // initial default setup of student list\n//     setup_filter_students_by_grade(course_id, 9); // extract this 9 from php which might be configurable in the future\n//\n// }\n\nfunction filter_students_by_grade_select() {\n\n    // Get the s delected grade value from the dropdown\n    const grade_select = document.getElementById('id_early_alert_filter_grade_select');\n    const course_id = document.getElementById('early_alert_filter_course_id').value;\n    const course_name = document.getElementById('early_alert_course_name').value;\n    const alert_type = document.getElementById('early-alert-alert-type').value;\n    const teacher_user_id = document.getElementById('early-alert-teacher-user-id').value;\n    // setup listener for drop down selection\n    grade_select.addEventListener('change', function (e) {\n        let grade_letter_id = e.target.value;\n        setup_filter_students_by_grade(course_id, grade_letter_id, course_name, alert_type, teacher_user_id);\n\n    });\n}\n\n/**\n * Fetches the student list based on the course_id and grade_letter_id\n * @param course_id\n * @param grade_letter_id\n * @param course_name\n * @param alert_type\n */\nfunction setup_filter_students_by_grade(course_id, grade_letter_id, course_name, alert_type, teacher_user_id) {\n    let selected_students = [];\n    // convert course_id into an integer\n    course_id = parseInt(course_id);\n    grade_letter_id = parseInt(grade_letter_id);\n    // Add course_id to element with id early_alert_filter_course_id\n    document.getElementById('early_alert_filter_course_id').value = course_id;\n    // Add alert type to element with id early-alert-alert-type\n    document.getElementById('early-alert-alert-type').value = alert_type;\n    // Add course name to element with id early_alert_course_name\n    document.getElementById('early_alert_course_name').value = course_name;\n\n    // Only display if course_id is greater than 0\n    if (course_id > 0) {\n        //Show loader\n        Templates.render('local_earlyalert/loader', {})\n            .then(function (html, js) {\n                // Insert the rendered template into the target element\n                document.getElementById('early-alert-student-results').innerHTML = html;\n                Templates.runTemplateJS(js);\n            })\n            .catch(function (error) {\n                console.error('Failed to render template:', error);\n            });\n\n\n\n        // Fetch student list and templates\n        var get_grades_and_templates = ajax.call([\n            { methodname: 'earlyalert_course_grades_percent_get', args: { id: course_id, grade_letter_id: grade_letter_id, \"teacher_user_id\": teacher_user_id } },\n            { methodname: 'earlyalert_course_student_templates', args: { \"teacher_user_id\": teacher_user_id, \"id\": course_id, \"alert_type\": alert_type } }\n        ]);\n\n        const finalCache = new Map();\n\n        Promise.all(get_grades_and_templates).then(([grades_response, templates_response]) => {\n\n            // Reformat the data to display in a grid\n            let num_students = grades_response.length;\n            console.log('Number of students returned: ' + num_students);\n            let num_rows = Math.min(3, Math.ceil(num_students / 3));\n            let num_cols = Math.ceil(num_students / num_rows);\n            let display_data = {\n                num_rows: num_rows,\n                num_cols: num_cols,\n                student_rows: []\n            };\n\n            let templates = [];\n\n            // Initialize rows array\n            for (let r = 0; r < num_rows; r++) {\n                display_data.student_rows[r] = {students: []};\n            }\n\n            let row = 0;\n            let col = 0;\n\n            grades_response.forEach(result => {\n                console.log(result);\n                if (typeof result === 'object') {\n                    if (!templates.includes(result.campus + \"_\" + result.faculty + \"_\" + result.major)) {\n                        templates.push(result.campus + \"_\" + result.faculty + \"_\" + result.major);\n                    }\n                    result.faculty = result.faculty ? result.faculty : '';\n                    result.major = result.major ? result.major : '';\n                    result.campus = result.campus ? result.campus : '';\n                    display_data.student_rows[row].students[col] = result;\n                    col++;\n                    if (col === num_cols) {\n                        col = 0;\n                        row++;\n                    }\n                }\n            });\n\n            display_data.templates = JSON.stringify(templates);\n\n            if (alert_type === 'grade') {\n                // Add alert_type to display_data\n                display_data.alert_type = 'Low Grade';\n                display_data.grade = true;\n            }\n\n            if (alert_type === 'assign') {\n                // Add alert_type to display_data\n                display_data.alert_type = 'Missed Assignment';\n                display_data.assign = true;\n            }\n\n            if (alert_type === 'exam') {\n                // Add alert_type to display_data\n                display_data.alert_type = 'Missed Exam';\n                display_data.exam = true;\n            }\n            display_data.fullname = course_name;\n// console.log( display_data);\n            // Render the template with display_data\n            Templates.render('local_earlyalert/course_student_list', display_data)\n                .then(function (html, js) {\n                    // Insert the rendered template into the target element\n                    document.getElementById('early-alert-student-results').innerHTML = html;\n                    Templates.runTemplateJS(js);\n                    // set default grade letter selected\n                    let grade_select = document.getElementById('id_early_alert_filter_grade_select');\n                    grade_select.value = grade_letter_id;\n                    // setup listener\n                    // filter_students_by_grade_select();\n                    check_all_student_grades(selected_students);\n                    check_allnone_listener(selected_students);\n\n                    const cachedArrayElement = document.getElementById('early-alert-template-cache');\n                    const cachedArray = JSON.parse(cachedArrayElement.value);\n\n                    templates_response.forEach(result => {\n                        if (typeof result === 'object') {\n                            if (cachedArray.includes(result.templateKey)){\n                                // finalCache.push({key: result.templateKey, value: result.message});\n                                let finalMessage = {subject: result.subject, message: result.message};\n                                finalCache.set(result.templateKey, finalMessage);\n                            }\n                        }\n                    });\n                    finalCache.set('course_name', course_name);\n                    setup_preview_emails(finalCache);\n                })\n                .catch(function (error) {\n                    console.error('Failed to render template:', error);\n                });\n        });\n\n    }\n}\n\n\nfunction check_all_student_grades(selected_students) {\n    const student_ids_selected = document.getElementById(\"early-alert-student-ids\") || {};\n    student_ids_selected.value = [];\n    const check_all_none_checkbox = document.getElementById('early-alert-checkall-student-checkbox');\n    check_all_none_checkbox.checked = true;\n    //check box for grade showing - remove later\n    const student_checkboxes = document.querySelectorAll(\"input[class^='early-alert-student-checkbox']\");\n    // check box for grade showing - remove later\n    student_checkboxes.forEach(function (checkbox) {\n        checkbox.checked = true;\n        selected_students.push(checkbox.getAttribute('data-student-id'));\n    });\n    student_ids_selected.value = JSON.stringify(selected_students);\n}\n\n// function to save to hidden field on submit if anyone unchecks student records\nfunction check_individual_students_checkboxes_for_submit(){\n    let selected_students = [];\n    const student_ids_selected = document.getElementById(\"early-alert-student-ids\") || {};\n    const student_checkboxes = document.querySelectorAll(\"input[class^='early-alert-student-checkbox']\");\n    student_checkboxes.forEach(function (checkbox) {\n        if (checkbox.checked){\n            selected_students.push(checkbox.getAttribute('data-student-id'));\n        }\n    });\n    student_ids_selected.value = JSON.stringify(selected_students);\n}\n\nfunction check_allnone_listener(selected_students) {\n    // Add an event listener to the select all checkbox\n    const check_all_none_checkbox = document.getElementById('early-alert-checkall-student-checkbox');\n    const student_ids_selected = document.getElementById(\"early-alert-student-ids\") || {};\n\n    check_all_none_checkbox.addEventListener('click', function () {\n        student_ids_selected.value = [];\n        // Get all checkboxes within the list\n        let checkboxes = document.querySelectorAll(\"input[class^='early-alert-student-checkbox']\");\n        // Loop through each checkbox and toggle its selection based on the state of the select all checkbox\n        checkboxes.forEach(function (checkbox) {\n            if (check_all_none_checkbox.checked) {\n                checkbox.checked = true;\n                selected_students.push(checkbox.getAttribute('data-student-id'));\n            } else {\n                checkbox.checked = false;\n                selected_students = selected_students.filter(item => item !== checkbox.getAttribute('data-student-id'));\n            }\n        });\n        student_ids_selected.value = JSON.stringify(selected_students);\n    });\n}\n\nfunction setup_preview_emails(templateCache) {\n    const preview_buttons = document.querySelectorAll(\".early-alert-preview-button\");\n    // Get the early-alert-alert-type value\n    const alert_type = document.getElementById('early-alert-alert-type').value;\n    // Loop through each checkbox and toggle its selection based on the state of the select all checkbox\n    //console.log(\"template cache:\", templateCache);\n    // store ALL the student data and template cache etc when its processed\n    let student_template_cache_array = [];\n    preview_buttons.forEach(function (button) {\n        let record_data = {};\n        const checkbox = button.closest('tr').querySelector('.early-alert-student-checkbox');\n        const assigngrade = button.closest('tr').querySelector('.early-alert-grade-column').querySelector('.badge').innerHTML;\n        const grade_select = document.getElementById('id_early_alert_filter_grade_select');\n        let selected_grade = grade_select.options[grade_select.selectedIndex].text;\n        if (checkbox) {\n\n            // now, access the parent <tr> element (the table row)\n            const table_row = checkbox.parentNode;\n            // extract the student name from the second <td> element within the table row\n            const student_name_td = table_row.nextElementSibling;\n            // fix and parse the name\n            const student_lname_fname = student_name_td.firstChild;\n            var student_name_arr = [];\n            var student_name = \"\";\n            student_lname_fname.data.split(/\\s*,\\s*/).forEach(function(me) {\n                student_name_arr.push(me);\n            });\n            student_name = student_name_arr[1] + ' ' + student_name_arr[0];\n            // console.log(student_name);\n            var student_id = checkbox.getAttribute('data-student-id');\n            const studentCampusAttr = checkbox.getAttribute('data-student-campus');\n            const studentFacultyAttr = checkbox.getAttribute('data-student-faculty');\n            const studentMajorAttr = checkbox.getAttribute('data-student-major');\n            var templateKey = studentCampusAttr  + '_'  + studentFacultyAttr  + '_'  + studentMajorAttr;\n            var templateEmailContent = '';\n            var templateEmailSubject = '';\n\n            if (templateCache.has(templateKey)) {\n                templateEmailSubject = templateCache.get(templateKey).subject;\n                templateEmailContent = templateCache.get(templateKey).message;\n            } else {\n                templateEmailSubject = 'Template not found';\n                templateEmailContent = 'Template not found';\n            }\n\n        } else {\n            // console.log(\"couldn't find checkbox :/\");\n        }\n        if (assigngrade){\n            // console.log(\"assign grade: \", assigngrade);\n        }\n        // console.log(\"template email content:\", templateEmailContent);\n\n        var params = {\n            studentname: student_name_arr,\n            assignmentgrade: assigngrade,\n            assignmenttitle: document.getElementById('early-alert-assignment-title') ? document.getElementById('early-alert-assignment-title').value : '',\n            coursename: templateCache.get('course_name'),\n            customgrade: grade_select.options[grade_select.selectedIndex].text,\n            defaultgrade: \"D+\"\n        };\n        templateEmailContent = addUserInfo(templateEmailContent, params );\n\n        // console.log(\"template email content post-addUserInfo:\", templateEmailContent);\n\n        // assemble record data for individual buttons which includes student and template data\n        record_data.student_id = student_id;\n        record_data.student_name = student_name;\n        record_data.course_name = templateCache.get('course_name');\n        record_data.templateEmailSubject = templateEmailSubject;\n        record_data.templateEmailContent = templateEmailContent;\n\n        button.addEventListener('click', function () {\n            setup_preview_buttons_from_template(record_data)\n        });\n        // add record to student_template_cache_array to have data to submit / email\n        student_template_cache_array.push(record_data);\n\n    });\n    // once we have all the data we can setup the emails to submit with the template cache data and student ids BUT we have to manage and select the users if they are checked/unchceked\n    setup_send_emails(student_template_cache_array);\n}\n\nfunction setup_preview_buttons_from_template(student_template_data) {\n\n    ModalFactory.create({\n        title: getString('preview_email', 'local_earlyalert'),\n        type: ModalFactory.types.CANCEL,\n        body: Templates.render('local_earlyalert/preview_student_email', {\n            name: student_template_data.template_name,\n            student_name: student_template_data.student_name,\n            subject: student_template_data.templateEmailSubject,\n            message: student_template_data.templateEmailContent,\n            instructor_name: ''\n        }),\n        large: true,\n    }).then(modal => {\n        modal.show();\n    });\n}\nfunction setup_send_emails(student_template_cache_array) {\n    const send_button = document.getElementById('early-alert-send-button1');\n    const send_button2 = document.getElementById('early-alert-send-button2');\n    send_button.addEventListener('click', function () {\n        maintain_student_template_data_for_submit(student_template_cache_array);\n    });\n    send_button2.addEventListener('click', function () {\n        maintain_student_template_data_for_submit(student_template_cache_array);\n    });\n}\n\nfunction maintain_student_template_data_for_submit(student_template_cache_array){\n    check_individual_students_checkboxes_for_submit();\n    var student_ids_array = JSON.parse(document.getElementById(\"early-alert-student-ids\").value); // hidden field ids\n    // remove students from template cache if they have been unchecked\n    var new_student_temp_array = student_template_cache_array.filter(student => student_ids_array.includes(student.student_id));\n    console.log('Filtered!');\n    console.log(new_student_temp_array);\n    create_notification_dialog(new_student_temp_array);\n}\n\nfunction create_notification_dialog(student_template_cache_array) {\n\n    console.log(student_template_cache_array);\n    // Get the data id attribute value\n    var send_string = getString('send_email', 'local_earlyalert');\n    var send_dialog_text = getString('send_dialog_text', 'local_earlyalert');\n    var send = getString('send', 'local_earlyalert');\n    var cancel = getString('cancel', 'local_earlyalert');\n    var could_not_send_email = getString('could_not_send_email', 'local_earlyalert');\n    var sent_dialog_text = getString('sent_dialog_text', 'local_earlyalert');\n\n    // Notification\n    notification.confirm(send_string, send_dialog_text, send, cancel, function () {\n        // Delete the record\n        var sendEmail = ajax.call([{\n            methodname: 'earlyalert_report_log_insert',\n            args: {\n                template_data: JSON.stringify(student_template_cache_array),\n            }\n        }]);\n        sendEmail[0].done(function () {\n            // success\n            sendEmail[0].then(result => {\n                notification.alert('Email', getString('sent_dialog_text', 'local_earlyalert', result));}\n            );\n        }).fail(function () {\n            //notification.alert(could_not_send_email);\n            notification.alert('Email', sent_dialog_text);\n        });\n    });\n}\n\n\n/**\n * Get users from the search input\n */\nfunction get_users() {\n    const inputElement = document.getElementById('search');\n    const datalistElement = document.getElementById('early-alert-impersonate');\n\n    // Event listener for input element\n    inputElement.addEventListener('input', function (event) {\n        const query = event.target.value;\n        var get_users = ajax.call([{\n            methodname: 'organization_users_get',\n            args: {\n                name: query\n            }\n        }]);\n        get_users[0].done(function (users) {\n            console.log(users);\n            datalistElement.innerHTML = '';\n            users.forEach(user => {\n                const option = document.createElement('option');\n                option.value = user.id;\n                option.text = user.firstname + ' ' + user.lastname;\n                datalistElement.appendChild(option);\n            });\n            // When a selection is made, reload the page with the user_id as a parameter\n            inputElement.addEventListener('change', function (event) {\n                window.location.href = window.location.href + '?user_id=' + event.target.value;\n            });\n\n        }).fail(function (e) {\n            alert(e);\n            // fail gracefully somehow :'( ;\n        });\n    });\n}\n\nfunction addUserInfo(emailText, params) {\n    // Define text replacements\n    const textReplace = [\n        '[firstname]',\n        '[fullname]',\n        '[usergrade]',\n        '[customgrade]',\n        '[defaultgrade]',\n        '[coursetitle]',\n        '[assignmenttitle]'\n    ];\n\n    // Build replacement info\n    let uniqueMatches = {};\n    for (let i = 0; i < textReplace.length; i++) {\n        if (emailText.includes(textReplace[i])) {\n            // Perform action for each unique match found\n            switch (i) {\n                case 0:\n                    // firstname action\n                    let firstNameText = params.studentname[1] ? params.studentname[1] : '{USER_NOT_FOUND}';\n                    uniqueMatches[i] = firstNameText;\n                    break;\n                case 1:\n                    // fullname action\n                    let targetUser = params.studentname[1] ? `${params.studentname[1]} ${params.studentname[0]}` : '{USER_NOT_FOUND}';\n                    uniqueMatches[i] = targetUser;\n                    break;\n                case 2:\n                    // usergrade action\n                    let userGradeText = params.assignmentgrade || '{GRADE NOT PROVIDED/FOUND}';\n                    uniqueMatches[i] = userGradeText;\n                    break;\n                case 3:\n                    // customgrade acton\n                    let customGradeText = params.customgrade || '{CUSTOM GRADE NOT PROVIDED/FOUND}';\n                    uniqueMatches[i] = customGradeText;\n                    break;\n                case 4:\n                    // defaultgrade acton\n                    let defaultGradeText = params.defaultgrade || '{DEFAULT GRADE NOT PROVIDED/FOUND}';\n                    uniqueMatches[i] = defaultGradeText;\n                    break;\n                case 5:\n                    // coursetitle action\n                    let courseTitleText = params.coursename || '{COURSE TITLE NOT FOUND}';\n                    uniqueMatches[i] = courseTitleText;\n                    break;\n                case 6:\n                    // assignmenttitle action\n                    let assignmentTitleText = params.assignmenttitle || '{ASSIGNMENT TITLE NOT FOUND}';\n                    uniqueMatches[i] = assignmentTitleText;\n                    break;\n            }\n        }\n    }\n    // Replace the text with the matched values\n    for (let i = 0; i < textReplace.length; i++) {\n        if (uniqueMatches[i]) {\n            emailText = emailText.replace(textReplace[i], uniqueMatches[i]);\n            // emailText = emailText.replace(new RegExp(textReplace[i], 'g'), uniqueMatches[i]);\n        }\n    }\n    return emailText;\n}\n"],"names":["setup_filter_students_by_grade","course_id","grade_letter_id","course_name","alert_type","teacher_user_id","selected_students","parseInt","document","getElementById","value","render","then","html","js","innerHTML","runTemplateJS","catch","error","console","get_grades_and_templates","ajax","call","methodname","args","id","finalCache","Map","Promise","all","_ref","grades_response","templates_response","num_students","length","log","num_rows","Math","min","ceil","num_cols","display_data","student_rows","templates","r","students","row","col","forEach","result","includes","campus","faculty","major","push","JSON","stringify","grade","assign","exam","fullname","student_ids_selected","checked","querySelectorAll","checkbox","getAttribute","check_all_student_grades","check_all_none_checkbox","addEventListener","filter","item","check_allnone_listener","cachedArrayElement","cachedArray","parse","templateKey","finalMessage","subject","message","set","templateCache","preview_buttons","student_template_cache_array","button","record_data","closest","querySelector","assigngrade","grade_select","options","selectedIndex","text","student_lname_fname","parentNode","nextElementSibling","firstChild","student_name_arr","student_name","data","split","me","student_id","templateEmailContent","templateEmailSubject","has","get","emailText","params","textReplace","uniqueMatches","i","firstNameText","studentname","targetUser","userGradeText","assignmentgrade","customGradeText","customgrade","defaultGradeText","defaultgrade","courseTitleText","coursename","assignmentTitleText","assignmenttitle","replace","addUserInfo","student_template_data","create","title","type","ModalFactory","types","CANCEL","body","Templates","name","template_name","instructor_name","large","modal","show","send_button","send_button2","maintain_student_template_data_for_submit","setup_send_emails","setup_preview_emails","check_individual_students_checkboxes_for_submit","student_ids_array","new_student_temp_array","student","send_string","send_dialog_text","send","cancel","sent_dialog_text","confirm","sendEmail","template_data","done","alert","fail","create_notification_dialog","event","target","classList","contains","inputElement","datalistElement","query","users","user","option","createElement","firstname","lastname","appendChild","window","location","href","e","get_users"],"mappings":"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"}