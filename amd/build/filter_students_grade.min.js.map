{"version":3,"file":"filter_students_grade.min.js","sources":["../src/filter_students_grade.js"],"sourcesContent":["import ajax from 'core/ajax';\nimport Templates from 'core/templates';\nimport ModalFactory from 'core/modal_factory';\nimport {get_string as getString} from 'core/str';\n\nexport const init = () => {\n    button_click();\n    filter_students_by_default_grade();\n};\n\nfunction button_click() {\n    // Get data-link when .early-alert-type-button link is clicked\n    document.addEventListener('click', function (event) {\n        if (event.target.classList.contains('early-alert-type-button')) {\n            let dataLink = event.target.getAttribute('data-link');\n            let link = event.target.getAttribute('data-href');\n            let course_name = event.target.getAttribute('data-name');\n            // Redirect to the link\n            window.location = link + '&alert_type=' + dataLink + '&course_name=' + course_name;\n        }\n    });\n}\n\n\n/**\n * Adds students with grades\n */\nfunction filter_students_by_default_grade() {\n\n    // Get course id from the hidden input field wiht id early_alert_filter_course_id\n    const course_id = document.getElementById('early_alert_filter_course_id').value;\n    // initial default setup of student list\n    setup_filter_students_by_grade(course_id, 9); // extract this 9 from php which might be configurable in the future\n\n}\n\nfunction filter_students_by_grade_select(){\n\n    // Get the s delected grade value from the dropdown\n    const grade_select = document.getElementById('id_early_alert_filter_grade_select');\n    const course_id = document.getElementById('early_alert_filter_course_id').value;\n    // setup listener for drop down selection\n\n    grade_select.addEventListener('change', function (e) {\n        let grade_letter_id = e.target.value;\n        setup_filter_students_by_grade(course_id, grade_letter_id);\n\n    });\n\n}\n\nfunction setup_filter_students_by_grade(course_id, grade_letter_id) {\n    let selected_students = [];\n    // convert course_id into an integer\n    course_id = parseInt(course_id);\n    grade_letter_id = parseInt(grade_letter_id);\n    const queryString = window.location.search;\n    const urlParams = new URLSearchParams(queryString);\n    let course_name = urlParams.get('course_name');\n\n    // Only display if course_id is greater than 0\n    if (course_id > 0) {\n        //Show loader\n        Templates.render('local_earlyalert/loader', {})\n            .then(function (html, js) {\n                // Insert the rendered template into the target element\n                document.getElementById('early-alert-student-results').innerHTML = html;\n                Templates.runTemplateJS(js);\n            })\n            .catch(function (error) {\n                console.error('Failed to render template:', error);\n            });\n\n        // Fetch the student list\n        var get_filtered_studentgrades = ajax.call([{\n            methodname: 'earlyalert_course_grades_percent_get',\n            args: {\n                id: course_id,\n                grade_letter_id: grade_letter_id\n            }\n        }]);\n        get_filtered_studentgrades[0].done(function (results) {\n\n            // Reformat the data to display in a grid\n            let num_students = results.length;\n            console.log('Number of students returned: ' + num_students);\n            let num_rows = Math.min(3, Math.ceil(num_students / 3));\n            let num_cols = Math.ceil(num_students / num_rows);\n            let display_data = {\n                num_rows: num_rows,\n                num_cols: num_cols,\n                student_rows: []\n            };\n\n// Initialize rows array\n            for (let r = 0; r < num_rows; r++) {\n                display_data.student_rows[r] = {students: []};\n            }\n\n            let row = 0;\n            let col = 0;\n\n            results.forEach(result => {\n                if (typeof result === 'object') {\n                    display_data.student_rows[row].students[col] = result;\n                    col++;\n                    if (col === num_cols) {\n                        col = 0;\n                        row++;\n                    }\n                }\n            });\n\n            // Get alert type\n            let alert_type = document.getElementById('early-alert-alert-type').value;\n\n            if (alert_type === 'grade') {\n                // Add alert_type to display_data\n                display_data.alert_type = 'Low Grade';\n            }\n\n            if (alert_type === 'assign') {\n                // Add alert_type to display_data\n                display_data.alert_type = 'Missed Assignment';\n            }\n\n            if (alert_type === 'exam') {\n                // Add alert_type to display_data\n                display_data.alert_type = 'Missed Exam';\n            }\n            display_data.fullname = course_name;\n\n            // Render the template with display_data\n            Templates.render('local_earlyalert/course_student_list', display_data)\n                .then(function (html, js) {\n                    // Insert the rendered template into the target element\n                    document.getElementById('early-alert-student-results').innerHTML = html;\n                    Templates.runTemplateJS(js);\n                    // set default grade letter selected\n                    let grade_select = document.getElementById('id_early_alert_filter_grade_select');\n                    grade_select.value = grade_letter_id;\n                    // setup listener\n                    filter_students_by_grade_select();\n                    check_all_student_grades(selected_students);\n                    check_allnone_listener(selected_students);\n                    setup_preview_emails();\n\n                })\n                .catch(function (error) {\n                    console.error('Failed to render template:', error);\n                });\n        }).fail(function (e) {\n            alert(e);\n            // fail gracefully somehow :'( ;\n        });\n    }\n}\n\n/**\n *  Filter your data based on the selected grade value (for example)\n * @param course_id\n * @param $grade_letter_id\n * @deprecated\n */\nfunction setup_filter_students_by_grade_original(course_id, $grade_letter_id) {\n    let selected_students = [];\n\n    var get_filtered_studentgrades = ajax.call([{\n        methodname: 'earlyalert_course_grades_percent_get',\n        args: {\n            id: course_id,\n            grade_letter_id: $grade_letter_id\n        }\n    }]);\n    get_filtered_studentgrades[0].done(function (results) {\n        //results.filter(item => item.grade === parseInt(selectedGrade));\n        //let t = selectedGrade;\n        // Update your page with the filtered data\n\n        const students_gradesList = document.getElementById('early_alert_filter_students_container');\n        students_gradesList.innerHTML = '';\n        const ulElement = document.createElement('ul');\n\n        let select_all_checkbox = document.createElement('INPUT');\n        select_all_checkbox.type = 'checkbox';\n        select_all_checkbox.className = 'early_alert_filterform_select_all_checkbox';\n        select_all_checkbox.id = 'early_alert_filterform_select_all_checkbox_0';\n\n        let select_all_li = document.createElement('LI');\n\n        // Create a label for the select allcheckbox\n        let select_all_label = document.createElement('LABEL');\n        select_all_label.textContent = 'Select All/None';\n        select_all_label.htmlFor = 'early_alert_filterform_select_all_checkbox';\n\n        let no_record = document.createElement('LABEL');\n        no_record.textContent = 'No records';\n        no_record.id = 'early_alert_filterform_li_nothing';\n\n        select_all_li.appendChild(select_all_checkbox);\n        select_all_li.appendChild(select_all_label);\n        ulElement.appendChild(select_all_li);\n        let i = 0;\n\n        let student_ids_selected = document.querySelector('input[name=\"student_ids\"]') || {};\n        student_ids_selected.value = [];\n        // Create an unordered list for each grade\n        results.forEach((item) => {\n\n            // Create a new list item (LI) element\n            let li = document.createElement('LI');\n            let checkbox = document.createElement('INPUT');\n            checkbox.type = 'checkbox';\n            checkbox.className = 'early_alert_filterform_checkbox';\n            checkbox.id = `early_alert_filterform_checkbox_${i}`;\n            checkbox.setAttribute('user_id', item.id);\n\n            // Add the checkbox to the list item (LI)\n            li.appendChild(checkbox);\n\n            // Create a div for column 1\n            let col1Div = document.createElement('DIV');\n            col1Div.className = 'column1';\n\n            // Create a label for the checkbox\n            let label = document.createElement('LABEL');\n            label.textContent = item.idnumber + ' | ' + item.first_name + ' ' + item.last_name;\n            label.htmlFor = `early_alert_filterform_checkbox_${i}`;\n\n            // Add the label to column 1 div\n            col1Div.appendChild(checkbox);\n            col1Div.appendChild(label);\n\n            // Add column 1 div to list item (LI)\n            li.appendChild(col1Div);\n\n            // Create a div for column 2\n            let col2Div = document.createElement('DIV');\n            col2Div.className = 'column2';\n\n            // Create a span for the pill element\n            let pillSpan = document.createElement('SPAN');\n            pillSpan.className = 'pill red';\n            pillSpan.textContent = item.grade;\n            pillSpan.id = `early_alert_filterform_grade_pill_${i}`;\n            pillSpan.style.display = 'none';\n\n            // Add the pill to column 2 div\n            col2Div.appendChild(pillSpan);\n\n            // Create another span for the value text\n            let valueSpan = document.createElement('SPAN');\n            valueSpan.className = 'value-text';\n\n            // Add the value text to column 2 div\n            col2Div.appendChild(valueSpan);\n\n            // Add column 2 div to list item (LI)\n            li.appendChild(col2Div);\n            ulElement.appendChild((li));\n            i++;\n        });\n        students_gradesList.appendChild(ulElement);\n\n        // Add an event listener to the select all checkbox\n        select_all_checkbox.addEventListener('change', function () {\n            // Get all checkboxes within the list\n            let checkboxes = document.querySelectorAll(\"input[class^='early_alert_filterform_checkbox']\");\n            // Loop through each checkbox and toggle its selection based on the state of the select all checkbox\n            checkboxes.forEach(function (checkbox) {\n                if (select_all_checkbox.checked) {\n                    checkbox.checked = true;\n                    selected_students.push(checkbox.getAttribute('user_id'));\n                } else {\n                    checkbox.checked = false;\n                    selected_students = selected_students.filter(item => item !== checkbox.getAttribute('user_id'));\n                }\n            });\n            student_ids_selected.value = JSON.stringify(selected_students);\n\n        });\n        // search dom for checkboxes and add to checked list\n        let grade_checkboxes = document.querySelectorAll(\"input[class^='early_alert_filterform_checkbox']\");\n        // Loop through each checkbox and toggle its selection based on the state of the select all checkbox\n        grade_checkboxes.forEach(function (checkbox) {\n            checkbox.addEventListener('click', function () {\n                if (checkbox.checked) {\n                    selected_students.push(checkbox.getAttribute('user_id'));\n                } else {\n                    selected_students = selected_students.filter(item => item !== checkbox.getAttribute('user_id'));\n                }\n                student_ids_selected.value = JSON.stringify(selected_students);\n            });\n\n        });\n        show_grades();\n    }).fail(function (e) {\n\n        alert(e);\n        // fail gracefully somehow :'( ;\n    });\n}\n\nfunction check_all_student_grades(selected_students) {\n    const student_ids_selected = document.getElementById(\"early-alert-student-ids\") || {};\n    student_ids_selected.value = [];\n    const check_all_none_checkbox = document.getElementById('early-alert-checkall-student-checkbox');\n    check_all_none_checkbox.checked = true;\n    //check box for grade showing - remove later\n    const student_checkboxes = document.querySelectorAll(\"input[class^='early-alert-student-checkbox']\");\n    // check box for grade showing - remove later\n    student_checkboxes.forEach(function (checkbox) {\n        checkbox.checked = true;\n        selected_students.push(checkbox.getAttribute('data-student-id'));\n    });\n    student_ids_selected.value = JSON.stringify(selected_students);\n}\n\nfunction check_allnone_listener(selected_students){\n    // Add an event listener to the select all checkbox\n    const check_all_none_checkbox = document.getElementById('early-alert-checkall-student-checkbox');\n    const student_ids_selected = document.getElementById(\"early-alert-student-ids\") || {};\n\n    check_all_none_checkbox.addEventListener('click', function () {\n        student_ids_selected.value = [];\n        // Get all checkboxes within the list\n        let checkboxes = document.querySelectorAll(\"input[class^='early-alert-student-checkbox']\");\n        // Loop through each checkbox and toggle its selection based on the state of the select all checkbox\n        checkboxes.forEach(function (checkbox) {\n            if (check_all_none_checkbox.checked) {\n                checkbox.checked = true;\n                selected_students.push(checkbox.getAttribute('data-student-id'));\n            } else {\n                checkbox.checked = false;\n                selected_students = selected_students.filter(item => item !== checkbox.getAttribute('data-student-id'));\n            }\n        });\n        student_ids_selected.value = JSON.stringify(selected_students);\n    });\n}\n\nfunction setup_preview_emails() {\n    const preview_buttons = document.querySelectorAll(\"input[class^='early-alert-preview-button']\");\n    // Loop through each checkbox and toggle its selection based on the state of the select all checkbox\n    ModalFactory.create({\n        title: getString('preview_email', 'local_earlyalert'),\n        type: ModalFactory.types.CANCEL,\n        body: Templates.render('local_earlyalert/preview_student_email', {name: 'etemplate name', student_name: 'Peter Parker', subject: 'Grade in AP/ECON 2350 3.00' , message: '<p> We know that many students juggle a lot alongside their academics. The academic advising team at the Faculty of Liberal Arts and Professional Studies works with professors to ensure that students receive information about their course progress so that way we can work with those who are facing challenges.<br>' +\n                '    We’re reaching out because your course director, Nick Valentino, has notified our office that you are averaging less than D+ in AP/ECON 2350 3.00, which puts you in danger of failing. </p>' +\n                '    <p><b><u>Your next step: Book an appointment with an advisor</u></b><br>' +\n                '    We want you to know that you’re not alone – it’s not uncommon for students to experience academic difficulties. We’re here to support you, and so we’re inviting you to a coaching session with your advisors at LA&PS Academic Advising Services. <u>Connect with them</u> at a day or time that is convenient for you!</p>' +\n                '    <p><b><u>Other helpful resources</u></b></br>' +\n                '    Looking for ways to manage your time? Study and learn more effectively? Keep up with readings and course work? Let <u>Learning Skills Services</u> help you achieve those goals.</br>' +\n                '    Feeling like you could use some extra support outside of the classroom? Explore <u>counselling and wellness resources </u>designed to help you navigate challenges and thrive throughout your journey here with us.</br>' +\n                '    Just not the course for you? That’s totally okay too. If this is the case just be sure that you are aware of the drop/withdraw deadlines, and what they mean.</br>' +\n                '    <p>Have unanswered questions? Why not <u>chat with SAVY?</u> You can ask SAVY about programs and courses, student life, campus services, career development and more.</p> ', instructor_name: ''}),\n        large: true,\n\n    }).then(modal => {\n        const preview_buttons = document.querySelectorAll(\".early-alert-preview-button\");\n        preview_buttons.forEach(function (button) {\n            button.addEventListener('click', function () {\n                modal.show();\n            });\n        });\n    });\n}\n\nfunction show_grades() {\n    // check box for grade showing - remove later\n    const show_grade_checkbox = document.getElementById('id_early_alert_filter_grade_chk');\n    // check box for grade showing - remove later\n    show_grade_checkbox.addEventListener('click', function () {\n        let grade_pills = document.querySelectorAll(\"span.pill\");\n        grade_pills.forEach(function (grade_pill) {\n            if (show_grade_checkbox.checked) {\n                if (grade_pill.style.display == 'none') {\n                    grade_pill.style.display = 'block';\n                }\n            } else {\n                grade_pill.style.display = 'none';\n            }\n        });\n    });\n}"],"names":["setup_filter_students_by_grade","course_id","grade_letter_id","selected_students","parseInt","queryString","window","location","search","course_name","URLSearchParams","get","render","then","html","js","document","getElementById","innerHTML","runTemplateJS","catch","error","console","ajax","call","methodname","args","id","done","results","num_students","length","log","num_rows","Math","min","ceil","num_cols","display_data","student_rows","r","students","row","col","forEach","result","alert_type","value","fullname","grade_select","addEventListener","e","target","filter_students_by_grade_select","student_ids_selected","checked","querySelectorAll","checkbox","push","getAttribute","JSON","stringify","check_all_student_grades","check_all_none_checkbox","filter","item","check_allnone_listener","create","title","type","ModalFactory","types","CANCEL","body","Templates","name","student_name","subject","message","instructor_name","large","modal","button","show","setup_preview_emails","fail","alert","event","classList","contains","dataLink","link"],"mappings":"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"}