{"version":3,"file":"filter_students_grade.min.js","sources":["../src/filter_students_grade.js"],"sourcesContent":["import ajax from 'core/ajax';\nimport Templates from 'core/templates';\n\nexport const init = () => {\n    button_click();\n    filter_students_by_grade();\n};\n\nfunction button_click() {\n    // Get data-link when .early-alert-type-button link is clicked\n    document.addEventListener('click', function (event) {\n        if (event.target.classList.contains('early-alert-type-button')) {\n            let dataLink = event.target.getAttribute('data-link');\n            let link = event.target.getAttribute('data-href');\n            // Redirect to the link\n            window.location = link + '&alert_type=' + dataLink;\n        }\n    });\n}\n\n\n/**\n * Adds students with grades\n */\nfunction filter_students_by_grade() {\n\n    // Get the s delected grade value from the dropdown\n    // const selected_grade = document.getElementById('id_early_alert_filter_grade_select');\n    // let $grade_letter_id = selected_grade.value;\n\n    // Get course id from the hidden input field wiht id early_alert_filter_course_id\n    const course_id = document.getElementById('early_alert_filter_course_id').value;\n    console.log('Course ID is ' + course_id);\n    setup_filter_students_by_grade(course_id, 9);\n\n    // selected_grade.addEventListener('change', function () {\n    //     $grade_letter_id = selected_grade.value;\n    //     setup_filter_students_by_grade(course_id, $grade_letter_id);\n    // });\n\n}\n\nfunction setup_filter_students_by_grade(course_id, $grade_letter_id) {\n    let selected_students = [];\n    // convert course_id into an integer\n    course_id = parseInt(course_id);\n    // Only display if course_id is greater than 0\n    if (course_id > 0) {\n        //Show loader\n        Templates.render('local_earlyalert/loader', {})\n            .then(function (html, js) {\n                // Insert the rendered template into the target element\n                document.getElementById('early-alert-student-results').innerHTML = html;\n                Templates.runTemplateJS(js);\n            })\n            .catch(function (error) {\n                console.error('Failed to render template:', error);\n            });\n\n        // Fetch the student list\n        var get_filtered_studentgrades = ajax.call([{\n            methodname: 'earlyalert_course_grades_percent_get',\n            args: {\n                id: course_id,\n                grade_letter_id: $grade_letter_id\n            }\n        }]);\n        get_filtered_studentgrades[0].done(function (results) {\n            // Reformat the data to display in a grid\n            let num_students = results.length;\n            let num_rows = Math.min(3, Math.ceil(num_students / 3));\n            let num_cols = Math.ceil(num_students / num_rows);\n            let display_data = {\n                num_rows: num_rows,\n                num_cols: num_cols,\n                student_rows: []\n            };\n\n// Initialize rows array\n            for (let r = 0; r < num_rows; r++) {\n                display_data.student_rows[r] = {students: []};\n            }\n\n            let row = 0;\n            let col = 0;\n\n            results.forEach(result => {\n                if (typeof result === 'object') {\n                    display_data.student_rows[row].students[col] = result;\n                    col++;\n                    if (col === num_cols) {\n                        col = 0;\n                        row++;\n                    }\n                }\n            });\n\n            // Get alert type\n            let alert_type = document.getElementById('early-alert-alert-type').value;\n\n            if (alert_type === 'grade') {\n                // Add alert_type to display_data\n                display_data.alert_type = 'Low Grade';\n            }\n\n            if (alert_type === 'assign') {\n                // Add alert_type to display_data\n                display_data.alert_type = 'Missed Assignment';\n            }\n\n            if (alert_type === 'exam') {\n                // Add alert_type to display_data\n                display_data.alert_type = 'Missed Exam';\n            }\n\n            // Render the template with display_data\n            Templates.render('local_earlyalert/course_student_list', display_data)\n                .then(function (html, js) {\n                    // Insert the rendered template into the target element\n                    document.getElementById('early-alert-student-results').innerHTML = html;\n                    Templates.runTemplateJS(js);\n                })\n                .catch(function (error) {\n                    console.error('Failed to render template:', error);\n                });\n        }).fail(function (e) {\n            alert(e);\n            // fail gracefully somehow :'( ;\n        });\n    }\n}\n\n/**\n *  Filter your data based on the selected grade value (for example)\n * @param course_id\n * @param $grade_letter_id\n * @deprecated\n */\nfunction setup_filter_students_by_grade_original(course_id, $grade_letter_id) {\n    let selected_students = [];\n\n    var get_filtered_studentgrades = ajax.call([{\n        methodname: 'earlyalert_course_grades_percent_get',\n        args: {\n            id: course_id,\n            grade_letter_id: $grade_letter_id\n        }\n    }]);\n    get_filtered_studentgrades[0].done(function (results) {\n        //results.filter(item => item.grade === parseInt(selectedGrade));\n        //let t = selectedGrade;\n        // Update your page with the filtered data\n\n        const students_gradesList = document.getElementById('early_alert_filter_students_container');\n        students_gradesList.innerHTML = '';\n        const ulElement = document.createElement('ul');\n\n        let select_all_checkbox = document.createElement('INPUT');\n        select_all_checkbox.type = 'checkbox';\n        select_all_checkbox.className = 'early_alert_filterform_select_all_checkbox';\n        select_all_checkbox.id = 'early_alert_filterform_select_all_checkbox_0';\n\n        let select_all_li = document.createElement('LI');\n\n        // Create a label for the select allcheckbox\n        let select_all_label = document.createElement('LABEL');\n        select_all_label.textContent = 'Select All/None';\n        select_all_label.htmlFor = 'early_alert_filterform_select_all_checkbox';\n\n        let no_record = document.createElement('LABEL');\n        no_record.textContent = 'No records';\n        no_record.id = 'early_alert_filterform_li_nothing';\n\n        select_all_li.appendChild(select_all_checkbox);\n        select_all_li.appendChild(select_all_label);\n        ulElement.appendChild(select_all_li);\n        let i = 0;\n\n        let student_ids_selected = document.querySelector('input[name=\"student_ids\"]') || {};\n        student_ids_selected.value = [];\n        // Create an unordered list for each grade\n        results.forEach((item) => {\n\n            // Create a new list item (LI) element\n            let li = document.createElement('LI');\n            let checkbox = document.createElement('INPUT');\n            checkbox.type = 'checkbox';\n            checkbox.className = 'early_alert_filterform_checkbox';\n            checkbox.id = `early_alert_filterform_checkbox_${i}`;\n            checkbox.setAttribute('user_id', item.id);\n\n            // Add the checkbox to the list item (LI)\n            li.appendChild(checkbox);\n\n            // Create a div for column 1\n            let col1Div = document.createElement('DIV');\n            col1Div.className = 'column1';\n\n            // Create a label for the checkbox\n            let label = document.createElement('LABEL');\n            label.textContent = item.idnumber + ' | ' + item.first_name + ' ' + item.last_name;\n            label.htmlFor = `early_alert_filterform_checkbox_${i}`;\n\n            // Add the label to column 1 div\n            col1Div.appendChild(checkbox);\n            col1Div.appendChild(label);\n\n            // Add column 1 div to list item (LI)\n            li.appendChild(col1Div);\n\n            // Create a div for column 2\n            let col2Div = document.createElement('DIV');\n            col2Div.className = 'column2';\n\n            // Create a span for the pill element\n            let pillSpan = document.createElement('SPAN');\n            pillSpan.className = 'pill red';\n            pillSpan.textContent = item.grade;\n            pillSpan.id = `early_alert_filterform_grade_pill_${i}`;\n            pillSpan.style.display = 'none';\n\n            // Add the pill to column 2 div\n            col2Div.appendChild(pillSpan);\n\n            // Create another span for the value text\n            let valueSpan = document.createElement('SPAN');\n            valueSpan.className = 'value-text';\n\n            // Add the value text to column 2 div\n            col2Div.appendChild(valueSpan);\n\n            // Add column 2 div to list item (LI)\n            li.appendChild(col2Div);\n            ulElement.appendChild((li));\n            i++;\n        });\n        students_gradesList.appendChild(ulElement);\n\n        // Add an event listener to the select all checkbox\n        select_all_checkbox.addEventListener('change', function () {\n            // Get all checkboxes within the list\n            let checkboxes = document.querySelectorAll(\"input[class^='early_alert_filterform_checkbox']\");\n            // Loop through each checkbox and toggle its selection based on the state of the select all checkbox\n            checkboxes.forEach(function (checkbox) {\n                if (select_all_checkbox.checked) {\n                    checkbox.checked = true;\n                    selected_students.push(checkbox.getAttribute('user_id'));\n                } else {\n                    checkbox.checked = false;\n                    selected_students = selected_students.filter(item => item !== checkbox.getAttribute('user_id'));\n                }\n            });\n            student_ids_selected.value = JSON.stringify(selected_students);\n\n        });\n        // search dom for checkboxes and add to checked list\n        let grade_checkboxes = document.querySelectorAll(\"input[class^='early_alert_filterform_checkbox']\");\n        // Loop through each checkbox and toggle its selection based on the state of the select all checkbox\n        grade_checkboxes.forEach(function (checkbox) {\n            checkbox.addEventListener('click', function () {\n                if (checkbox.checked) {\n                    selected_students.push(checkbox.getAttribute('user_id'));\n                } else {\n                    selected_students = selected_students.filter(item => item !== checkbox.getAttribute('user_id'));\n                }\n                student_ids_selected.value = JSON.stringify(selected_students);\n            });\n\n        });\n        show_grades();\n    }).fail(function (e) {\n\n        alert(e);\n        // fail gracefully somehow :'( ;\n    });\n}\n\nfunction show_grades() {\n    // check box for grade showing - remove later\n    const show_grade_checkbox = document.getElementById('id_early_alert_filter_grade_chk');\n    // check box for grade showing - remove later\n    show_grade_checkbox.addEventListener('click', function () {\n        let grade_pills = document.querySelectorAll(\"span.pill\");\n        grade_pills.forEach(function (grade_pill) {\n            if (show_grade_checkbox.checked) {\n                if (grade_pill.style.display == 'none') {\n                    grade_pill.style.display = 'block';\n                }\n            } else {\n                grade_pill.style.display = 'none';\n            }\n        });\n    });\n}"],"names":["document","addEventListener","event","target","classList","contains","dataLink","getAttribute","link","window","location","course_id","getElementById","value","console","log","$grade_letter_id","parseInt","render","then","html","js","innerHTML","runTemplateJS","catch","error","ajax","call","methodname","args","id","grade_letter_id","done","results","num_students","length","num_rows","Math","min","ceil","num_cols","display_data","student_rows","r","students","row","col","forEach","result","alert_type","fail","e","alert","setup_filter_students_by_grade","filter_students_by_grade"],"mappings":"6XAGoB,KAOhBA,SAASC,iBAAiB,SAAS,SAAUC,UACrCA,MAAMC,OAAOC,UAAUC,SAAS,2BAA4B,KACxDC,SAAWJ,MAAMC,OAAOI,aAAa,aACrCC,KAAON,MAAMC,OAAOI,aAAa,aAErCE,OAAOC,SAAWF,KAAO,eAAiBF,8BAgB5CK,UAAYX,SAASY,eAAe,gCAAgCC,MAC1EC,QAAQC,IAAI,gBAAkBJ,oBAUMA,UAAWK,sBAG/CL,UAAYM,SAASN,YAEL,EAAG,oBAELO,OAAO,0BAA2B,IACvCC,MAAK,SAAUC,KAAMC,IAElBrB,SAASY,eAAe,+BAA+BU,UAAYF,wBACzDG,cAAcF,OAE3BG,OAAM,SAAUC,OACbX,QAAQW,MAAM,6BAA8BA,UAInBC,cAAKC,KAAK,CAAC,CACxCC,WAAY,uCACZC,KAAM,CACFC,GAAInB,UACJoB,gBAAiBf,qBAGE,GAAGgB,MAAK,SAAUC,aAErCC,aAAeD,QAAQE,OACvBC,SAAWC,KAAKC,IAAI,EAAGD,KAAKE,KAAKL,aAAe,IAChDM,SAAWH,KAAKE,KAAKL,aAAeE,UACpCK,aAAe,CACfL,SAAUA,SACVI,SAAUA,SACVE,aAAc,QAIb,IAAIC,EAAI,EAAGA,EAAIP,SAAUO,IAC1BF,aAAaC,aAAaC,GAAK,CAACC,SAAU,QAG1CC,IAAM,EACNC,IAAM,EAEVb,QAAQc,SAAQC,SACU,iBAAXA,SACPP,aAAaC,aAAaG,KAAKD,SAASE,KAAOE,OAC/CF,MACIA,MAAQN,WACRM,IAAM,EACND,eAMRI,WAAajD,SAASY,eAAe,0BAA0BC,MAEhD,UAAfoC,aAEAR,aAAaQ,WAAa,aAGX,WAAfA,aAEAR,aAAaQ,WAAa,qBAGX,SAAfA,aAEAR,aAAaQ,WAAa,kCAIpB/B,OAAO,uCAAwCuB,cACpDtB,MAAK,SAAUC,KAAMC,IAElBrB,SAASY,eAAe,+BAA+BU,UAAYF,wBACzDG,cAAcF,OAE3BG,OAAM,SAAUC,OACbX,QAAQW,MAAM,6BAA8BA,aAErDyB,MAAK,SAAUC,GACdC,MAAMD,OA7FdE,CAA+B1C,UAAW,GA5B1C2C"}