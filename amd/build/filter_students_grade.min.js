define("local_earlyalert/filter_students_grade",["exports","core/ajax","core/templates"],(function(_exports,_ajax,_templates){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates);function setup_filter_students_by_grade(course_id,grade_letter_id){let selected_students=[];course_id=parseInt(course_id),grade_letter_id=parseInt(grade_letter_id);const queryString=window.location.search;let course_name=new URLSearchParams(queryString).get("course_name");course_id>0&&(_templates.default.render("local_earlyalert/loader",{}).then((function(html,js){document.getElementById("early-alert-student-results").innerHTML=html,_templates.default.runTemplateJS(js)})).catch((function(error){console.error("Failed to render template:",error)})),_ajax.default.call([{methodname:"earlyalert_course_grades_percent_get",args:{id:course_id,grade_letter_id:grade_letter_id}}])[0].done((function(results){let num_students=results.length;console.log("Number of students returned: "+num_students);let num_rows=Math.min(3,Math.ceil(num_students/3)),num_cols=Math.ceil(num_students/num_rows),display_data={num_rows:num_rows,num_cols:num_cols,student_rows:[]};for(let r=0;r<num_rows;r++)display_data.student_rows[r]={students:[]};let row=0,col=0;results.forEach((result=>{"object"==typeof result&&(display_data.student_rows[row].students[col]=result,col++,col===num_cols&&(col=0,row++))}));let alert_type=document.getElementById("early-alert-alert-type").value;"grade"===alert_type&&(display_data.alert_type="Low Grade"),"assign"===alert_type&&(display_data.alert_type="Missed Assignment"),"exam"===alert_type&&(display_data.alert_type="Missed Exam"),display_data.fullname=course_name,_templates.default.render("local_earlyalert/course_student_list",display_data).then((function(html,js){document.getElementById("early-alert-student-results").innerHTML=html,_templates.default.runTemplateJS(js),document.getElementById("id_early_alert_filter_grade_select").value=grade_letter_id,function(){const grade_select=document.getElementById("id_early_alert_filter_grade_select"),course_id=document.getElementById("early_alert_filter_course_id").value;grade_select.addEventListener("change",(function(e){let grade_letter_id=e.target.value;setup_filter_students_by_grade(course_id,grade_letter_id)}))}(),function(selected_students){const student_ids_selected=document.getElementById("early-alert-student-ids")||{};student_ids_selected.value=[];document.getElementById("early-alert-checkall-student-checkbox").checked=!0;document.querySelectorAll("input[class^='early-alert-student-checkbox']").forEach((function(checkbox){checkbox.checked=!0,selected_students.push(checkbox.getAttribute("data-student-id"))})),student_ids_selected.value=JSON.stringify(selected_students)}(selected_students),function(selected_students){const check_all_none_checkbox=document.getElementById("early-alert-checkall-student-checkbox"),student_ids_selected=document.getElementById("early-alert-student-ids")||{};check_all_none_checkbox.addEventListener("click",(function(){student_ids_selected.value=[],document.querySelectorAll("input[class^='early-alert-student-checkbox']").forEach((function(checkbox){check_all_none_checkbox.checked?(checkbox.checked=!0,selected_students.push(checkbox.getAttribute("data-student-id"))):(checkbox.checked=!1,selected_students=selected_students.filter((item=>item!==checkbox.getAttribute("data-student-id"))))})),student_ids_selected.value=JSON.stringify(selected_students)}))}(selected_students)})).catch((function(error){console.error("Failed to render template:",error)}))})).fail((function(e){alert(e)})))}_exports.init=()=>{document.addEventListener("click",(function(event){if(event.target.classList.contains("early-alert-type-button")){let dataLink=event.target.getAttribute("data-link"),link=event.target.getAttribute("data-href"),course_name=event.target.getAttribute("data-name");window.location=link+"&alert_type="+dataLink+"&course_name="+course_name}})),setup_filter_students_by_grade(document.getElementById("early_alert_filter_course_id").value,9)}}));

//# sourceMappingURL=filter_students_grade.min.js.map