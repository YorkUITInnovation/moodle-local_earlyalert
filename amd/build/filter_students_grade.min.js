define("local_earlyalert/filter_students_grade",["exports","core/ajax","core/templates","core/modal_factory","core/str","core/notification"],(function(_exports,_ajax,_templates,_modal_factory,_str,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_modal_factory=_interopRequireDefault(_modal_factory),_notification=_interopRequireDefault(_notification);function setup_filter_students_by_grade(course_id,grade_letter_id){let selected_students=[];course_id=parseInt(course_id),grade_letter_id=parseInt(grade_letter_id);const queryString=window.location.search;let course_name=new URLSearchParams(queryString).get("course_name");course_id>0&&(_templates.default.render("local_earlyalert/loader",{}).then((function(html,js){document.getElementById("early-alert-student-results").innerHTML=html,_templates.default.runTemplateJS(js)})).catch((function(error){console.error("Failed to render template:",error)})),_ajax.default.call([{methodname:"earlyalert_course_grades_percent_get",args:{id:course_id,grade_letter_id:grade_letter_id}}])[0].done((function(results){let num_students=results.length;console.log("Number of students returned: "+num_students);let num_rows=Math.min(3,Math.ceil(num_students/3)),num_cols=Math.ceil(num_students/num_rows),display_data={num_rows:num_rows,num_cols:num_cols,student_rows:[]};for(let r=0;r<num_rows;r++)display_data.student_rows[r]={students:[]};let row=0,col=0;results.forEach((result=>{"object"==typeof result&&(display_data.student_rows[row].students[col]=result,col++,col===num_cols&&(col=0,row++))}));let alert_type=document.getElementById("early-alert-alert-type").value;"grade"===alert_type&&(display_data.alert_type="Low Grade"),"assign"===alert_type&&(display_data.alert_type="Missed Assignment"),"exam"===alert_type&&(display_data.alert_type="Missed Exam"),display_data.fullname=course_name,_templates.default.render("local_earlyalert/course_student_list",display_data).then((function(html,js){document.getElementById("early-alert-student-results").innerHTML=html,_templates.default.runTemplateJS(js),document.getElementById("id_early_alert_filter_grade_select").value=grade_letter_id,function(){const grade_select=document.getElementById("id_early_alert_filter_grade_select"),course_id=document.getElementById("early_alert_filter_course_id").value;grade_select.addEventListener("change",(function(e){let grade_letter_id=e.target.value;setup_filter_students_by_grade(course_id,grade_letter_id)}))}(),function(selected_students){const student_ids_selected=document.getElementById("early-alert-student-ids")||{};student_ids_selected.value=[];document.getElementById("early-alert-checkall-student-checkbox").checked=!0;document.querySelectorAll("input[class^='early-alert-student-checkbox']").forEach((function(checkbox){checkbox.checked=!0,selected_students.push(checkbox.getAttribute("data-student-id"))})),student_ids_selected.value=JSON.stringify(selected_students)}(selected_students),function(selected_students){const check_all_none_checkbox=document.getElementById("early-alert-checkall-student-checkbox"),student_ids_selected=document.getElementById("early-alert-student-ids")||{};check_all_none_checkbox.addEventListener("click",(function(){student_ids_selected.value=[],document.querySelectorAll("input[class^='early-alert-student-checkbox']").forEach((function(checkbox){check_all_none_checkbox.checked?(checkbox.checked=!0,selected_students.push(checkbox.getAttribute("data-student-id"))):(checkbox.checked=!1,selected_students=selected_students.filter((item=>item!==checkbox.getAttribute("data-student-id"))))})),student_ids_selected.value=JSON.stringify(selected_students)}))}(selected_students),function(){document.querySelectorAll("input[class^='early-alert-preview-button']");_modal_factory.default.create({title:(0,_str.get_string)("preview_email","local_earlyalert"),type:_modal_factory.default.types.CANCEL,body:_templates.default.render("local_earlyalert/preview_student_email",{name:"etemplate name",student_name:"Fred",subject:"Grade in AP/ECON 2350 3.00",message:"<p> We know that many students juggle a lot alongside their academics. The academic advising team at the Faculty of Liberal Arts and Professional Studies works with professors to ensure that students receive information about their course progress so that way we can work with those who are facing challenges.<br>    We’re reaching out because your course director, Nick Valentino, has notified our office that you are averaging less than D+ in AP/ECON 2350 3.00, which puts you in danger of failing. </p>    <p><b><u>Your next step: Book an appointment with an advisor</u></b><br>    We want you to know that you’re not alone – it’s not uncommon for students to experience academic difficulties. We’re here to support you, and so we’re inviting you to a coaching session with your advisors at LA&PS Academic Advising Services. <u>Connect with them</u> at a day or time that is convenient for you!</p>    <p><b><u>Other helpful resources</u></b></br>    Looking for ways to manage your time? Study and learn more effectively? Keep up with readings and course work? Let <u>Learning Skills Services</u> help you achieve those goals.</br>    Feeling like you could use some extra support outside of the classroom? Explore <u>counselling and wellness resources </u>designed to help you navigate challenges and thrive throughout your journey here with us.</br>    Just not the course for you? That’s totally okay too. If this is the case just be sure that you are aware of the drop/withdraw deadlines, and what they mean.</br>    <p>Have unanswered questions? Why not <u>chat with SAVY?</u> You can ask SAVY about programs and courses, student life, campus services, career development and more.</p> ",instructor_name:""}),large:!0}).then((modal=>{document.querySelectorAll(".early-alert-preview-button").forEach((function(button){button.addEventListener("click",(function(){modal.show()}))}))}))}(),function(){const send_button=document.getElementById("early-alert-send-button1"),send_button2=document.getElementById("early-alert-send-button2");var ids=document.getElementById("early-alert-student-ids").value;send_button.addEventListener("click",(function(){create_notification_dialog(ids)})),send_button2.addEventListener("click",(function(){create_notification_dialog(ids)}))}()})).catch((function(error){console.error("Failed to render template:",error)}))})).fail((function(e){alert(e)})))}function create_notification_dialog(ids){var send_string=(0,_str.get_string)("send_email","local_earlyalert"),send_dialog_text=(0,_str.get_string)("send_dialog_text","local_earlyalert"),send=(0,_str.get_string)("send","local_earlyalert"),cancel=(0,_str.get_string)("cancel","local_earlyalert"),sent_email=(0,_str.get_string)("sent_email","local_earlyalert"),sent_dialog_text=((0,_str.get_string)("could_not_send_email","local_earlyalert"),(0,_str.get_string)("sent_dialog_text","local_earlyalert"));_notification.default.confirm(send_string,send_dialog_text,send,cancel,(function(){_ajax.default.call([{methodname:"local_earlyalert_sendEmail",args:{id:ids}}])[0].done((function(){_notification.default.alert("Email",sent_email)})).fail((function(){_notification.default.alert("Email",sent_dialog_text)}))}))}_exports.init=()=>{document.addEventListener("click",(function(event){if(event.target.classList.contains("early-alert-type-button")){let dataLink=event.target.getAttribute("data-link"),link=event.target.getAttribute("data-href"),course_name=event.target.getAttribute("data-name");window.location=link+"&alert_type="+dataLink+"&course_name="+course_name}})),setup_filter_students_by_grade(document.getElementById("early_alert_filter_course_id").value,9)}}));

//# sourceMappingURL=filter_students_grade.min.js.map