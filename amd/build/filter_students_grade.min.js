define("local_earlyalert/filter_students_grade",["exports","core/ajax","core/templates","core/modal_factory","core/modal_events","core/str","core/notification","local_earlyalert/select_box","core/config","local_earlyalert/select_course_box"],(function(_exports,_ajax,_templates,_modal_factory,_modal_events,_str,_notification,_select_box,_config,_select_course_box){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_notification=_interopRequireDefault(_notification),_select_box=_interopRequireDefault(_select_box),_config=_interopRequireDefault(_config),_select_course_box=_interopRequireDefault(_select_course_box);function setup_custom_message_listener(){const textarea=document.getElementById("early-alert-custom-message"),preview=document.querySelector(".custom-message-preview");if(!textarea||!preview)return void console.log("No custom message textarea or preview found");const new_textarea=textarea.cloneNode(!0);textarea.parentNode.replaceChild(new_textarea,textarea);new_textarea.addEventListener("input",(()=>{const message=(new_textarea.value||"").trim();window.currentTemplateCache&&window.currentTemplateCache.set("custom_message",message)})),new_textarea.addEventListener("blur",(()=>{const templateCache=build_template_cache(),alert_type_el=document.getElementById("early-alert-alert-type");if("assign"===(alert_type_el?alert_type_el.value:"")){const at=document.getElementById("early-alert-assignment-title"),assignmentTitle=at&&at.value||"";templateCache.set("assignment_title",assignmentTitle),setup_preview_emails_with_titles(templateCache)}else setup_preview_buttons(templateCache)}))}function build_template_cache(){const template_cache_input_el=document.getElementById("early-alert-template-cache");console.log("Rebuilding template cache");const cached_array=template_cache_input_el?JSON.parse(template_cache_input_el.value):[],course_name=document.getElementById("early_alert_course_name").value;console.log(" template cache"),console.log(cached_array);const textarea_el=document.getElementById("early-alert-custom-message"),custom_message=textarea_el?textarea_el.value.trim():"",final_cache=new Map;final_cache.set("course_name",course_name),final_cache.set("custom_message",custom_message);const current_cache=window.currentTemplateCache||{};return current_cache&&"function"==typeof current_cache.forEach&&current_cache.forEach(((value,key)=>{"course_name"!==key&&"custom_message"!==key&&"assignment_title"!==key&&final_cache.set(key,value)})),window.currentTemplateCache=final_cache,final_cache}function filter_students_by_grade_select(){const grade_select=document.getElementById("id_early_alert_filter_grade_select")||{},not_using_gradebook_checkbox=document.getElementById("early-alert-not-using-gradebook-checkbox"),course_id=document.getElementById("early_alert_filter_course_id").value,course_name=document.getElementById("early_alert_course_name").value,alert_type=document.getElementById("early-alert-alert-type").value,teacher_user_id=document.getElementById("early-alert-teacher-user-id").value;grade_select.addEventListener("change",(function(e){let grade_letter_id=e.target.value;if(not_using_gradebook_checkbox&&not_using_gradebook_checkbox.checked){setup_preview_buttons(build_template_cache())}else console.log("On normal call Grade letter selected: "+grade_letter_id),setup_filter_students_by_grade(course_id,grade_letter_id,course_name,alert_type,teacher_user_id)})),not_using_gradebook_checkbox&&not_using_gradebook_checkbox.addEventListener("change",(function(e){const current_grade=grade_select.value;e.target.checked?(console.log("Gade letter when using no grade checkbox checked:  "+current_grade),setup_filter_students_by_grade(course_id,-1,course_name,alert_type,teacher_user_id)):(console.log("Grade letter when NOT using :  "+current_grade),setup_filter_students_by_grade(course_id,current_grade,course_name,alert_type,teacher_user_id))}))}function filter_students_by_assignment(){document.getElementById("id_early_alert_filter_grade_select");const course_id=document.getElementById("early_alert_filter_course_id").value,course_name=document.getElementById("early_alert_course_name").value,alert_type=document.getElementById("early-alert-alert-type").value,teacher_user_id=document.getElementById("early-alert-teacher-user-id").value,assignment_input=document.getElementById("early-alert-assignment-title");assignment_input.addEventListener("input",(function(){validateAssignmentTitle(assignment_input.value.trim())})),assignment_input.addEventListener("focusout",(function(evt){var assignment_title=assignment_input.value.trim();validateAssignmentTitle(assignment_title)&&setup_filter_students_by_grade(course_id,-1,course_name,alert_type,teacher_user_id,assignment_title)})),validateAssignmentTitle(assignment_input.value.trim())}function setup_filter_students_by_grade(course_id,grade_letter_id,course_name,alert_type,teacher_user_id){let assignment_title=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",selected_students=[];if(course_id=parseInt(course_id),grade_letter_id=parseInt(grade_letter_id),console.log(grade_letter_id," - grade letter id being used to filter students"),document.getElementById("early_alert_filter_course_id").value=course_id,document.getElementById("early-alert-alert-type").value=alert_type,document.getElementById("early_alert_course_name").value=course_name,course_id>0){_templates.default.render("local_earlyalert/loader",{}).then((function(html,js){document.getElementById("early-alert-student-results").innerHTML=html,_templates.default.runTemplateJS(js)})).catch((function(error){console.error("Failed to render template:",error)}));var finalCache=new Map;console.log("earlyalert_course_grades_percent_get,   earlyalert_course_student_templates for course_id: "+course_id+", grade_letter_id: "+grade_letter_id+", alert_type: "+alert_type);var get_grades_and_templates=_ajax.default.call([{methodname:"earlyalert_course_grades_percent_get",args:{id:course_id,grade_letter_id:grade_letter_id,teacher_user_id:teacher_user_id}},{methodname:"earlyalert_course_student_templates",args:{teacher_user_id:teacher_user_id,id:course_id,alert_type:alert_type}}]);Promise.all(get_grades_and_templates).then((_ref=>{let[grades_response,templates_response]=_ref;console.log("grade response1: ",grades_response),console.log("template response1: ",templates_response);let num_students=grades_response.length,num_rows=Math.min(3,Math.ceil(num_students/3)),num_cols=Math.ceil(num_students/num_rows),display_data={num_rows:num_rows,num_cols:num_cols,student_rows:[]},templates=[];for(let r=0;r<num_rows;r++)display_data.student_rows[r]={students:[]};let row=0,col=0;grades_response.forEach((result=>{if("object"==typeof result){if(!templates.includes("course_"+course_id+"_"+result.lang+"_"+result.idnumber)){var course_lang="course_"+course_id+"_"+result.lang+"_"+result.idnumber;templates.push(course_lang)}if(!templates.includes(result.campus+"_"+result.lang+"_"+result.idnumber)){var campus_lang=result.campus+"_"+result.lang+"_"+result.idnumber;templates.push(campus_lang)}if(!templates.includes(result.campus+"_"+result.faculty+"_"+result.lang+"_"+result.idnumber)){var campus_fac_lang=result.campus+"_"+result.faculty+"_"+result.lang+"_"+result.idnumber;templates.push(campus_fac_lang)}if(!templates.includes(result.campus+"_"+result.faculty+"_"+result.major+"_"+result.lang+"_"+result.idnumber)){var campus_fac_maj_lang=result.campus+"_"+result.faculty+"_"+result.major+"_"+result.lang+"_"+result.idnumber;templates.push(campus_fac_maj_lang)}result.faculty=result.faculty?result.faculty:"",result.major=result.major?result.major:"",result.campus=result.campus?result.campus:"",result.courseid=course_id,display_data.student_rows[row].students[col]=result,col++,col===num_cols&&(col=0,row++)}})),display_data.templates=JSON.stringify(templates);let hascustommessage=0;Array.isArray(templates_response)&&templates_response.length>0&&(hascustommessage=templates_response.some((t=>t&&1===t.hascustommessage))?1:0),display_data.hascustommessage=hascustommessage,"grade"===alert_type&&(display_data.alert_type="Low Grade",display_data.grade=!0),"assign"===alert_type&&(display_data.alert_type="Missed Assignment",display_data.assign=!0),"exam"===alert_type&&(display_data.alert_type="Missed Exam",display_data.exam=!0),display_data.fullname=course_name,_templates.default.render("local_earlyalert/course_student_list",display_data).then((function(html,js){if(document.getElementById("early-alert-student-results").innerHTML=html,_templates.default.runTemplateJS(js),focusOnCheckall(),setup_custom_message_listener(),setup_custom_message_toggles(),"grade"===alert_type){let grade_select=document.getElementById("id_early_alert_filter_grade_select")||{};const not_using_gradebook_checkbox=document.getElementById("early-alert-not-using-gradebook-checkbox");if(-1===grade_letter_id){grade_select.value;not_using_gradebook_checkbox&&(not_using_gradebook_checkbox.checked=!0),grade_select.value=9}else grade_letter_id>0&&(grade_select.value=grade_letter_id,not_using_gradebook_checkbox&&(not_using_gradebook_checkbox.checked=!1));filter_students_by_grade_select()}"assign"===alert_type&&(document.getElementById("early-alert-assignment-title").value=assignment_title,filter_students_by_assignment()),check_allnone_listener(selected_students);const cachedArrayElement=document.getElementById("early-alert-template-cache"),cachedArray=JSON.parse(cachedArrayElement.value);templates_response.forEach((result=>{if("object"==typeof result&&cachedArray.includes(result.templateKey)){let finalMessage={subject:result.subject,message:result.message,templateid:result.templateid,revision_id:result.revision_id,course_id:result.course_id,instructor_id:result.instructor_id,triggered_from_user_id:result.triggered_from_user_id};finalCache.set(result.templateKey,finalMessage)}})),finalCache.set("course_name",course_name),finalCache.has("custom_message")||finalCache.set("custom_message",""),window.currentTemplateCache=finalCache,"assign"===alert_type?(finalCache.set("assignment_title",assignment_title),assignment_title&&setup_preview_emails_with_titles(finalCache)):setup_preview_buttons(finalCache)})).catch((function(error){console.error("Failed to render template:",error)}))}))}}function check_individual_students_checkboxes_for_submit(){let selected_students=[];const student_ids_selected=document.getElementById("early-alert-student-ids")||{};document.querySelectorAll("input[class^='early-alert-student-checkbox']").forEach((function(checkbox){checkbox.checked&&selected_students.push(checkbox.getAttribute("data-student-id"))})),student_ids_selected.value=JSON.stringify(selected_students)}function check_allnone_listener(selected_students){const check_all_none_checkbox=document.getElementById("early-alert-checkall-student-checkbox"),student_ids_selected=document.getElementById("early-alert-student-ids")||{};check_all_none_checkbox.addEventListener("click",(function(){student_ids_selected.value=[],document.querySelectorAll("input[class^='early-alert-student-checkbox']").forEach((function(checkbox){check_all_none_checkbox.checked?(checkbox.checked=!0,selected_students.push(checkbox.getAttribute("data-student-id"))):(checkbox.checked=!1,selected_students=selected_students.filter((item=>item!==checkbox.getAttribute("data-student-id"))))})),student_ids_selected.value=JSON.stringify(selected_students)}))}function validateAssignmentTitle(title){const errorElement=document.getElementById("assignment-title-error"),sendButtons=document.querySelectorAll(".early-alert-send-button"),previewButtons=document.querySelectorAll(".early-alert-preview-button");return title?(errorElement&&(errorElement.style.display="none"),sendButtons.forEach((button=>{button.disabled=!1,button.title=""})),previewButtons.forEach((button=>{button.disabled=!1,button.classList.remove("disabled"),button.title=""})),!0):(errorElement&&(errorElement.style.display="block"),sendButtons.forEach((button=>{button.disabled=!0,button.title="Assignment title is required"})),previewButtons.forEach((button=>{button.disabled=!0,button.classList.add("disabled"),button.title="Assignment title is required"})),!1)}function setup_preview_buttons(templateCache){const alert_type=document.getElementById("early-alert-alert-type").value,custom_message=templateCache.get("custom_message")||"";let student_template_cache_array=[];document.querySelectorAll(".early-alert-preview-button").forEach((button=>{const clone=button.cloneNode(!0);button.parentNode.replaceChild(clone,button)}));document.querySelectorAll(".early-alert-preview-button").forEach((function(button){let record_data={};const checkbox=button.closest("tr").querySelector(".early-alert-student-checkbox"),assigngrade=button.closest("tr").querySelector(".early-alert-grade-column").querySelector(".badge").innerHTML;let selected_grade="",selected_grade_value=0;if("grade"===alert_type){const grade_select=document.getElementById("id_early_alert_filter_grade_select")||{};selected_grade=grade_select.options[grade_select.selectedIndex].text,selected_grade_value=grade_select.value}let templateObj={};if(checkbox){const student_lname_fname=checkbox.parentNode.nextElementSibling.firstChild;var student_name_arr=[],student_name="";student_lname_fname.data.split(/\s*,\s*/).forEach((function(me){student_name_arr.push(me)})),student_name=student_name_arr[1]+" "+student_name_arr[0];var student_id=checkbox.getAttribute("data-student-id"),student_idnumber=checkbox.getAttribute("data-student-idnumber");const studentCampusAttr=checkbox.getAttribute("data-student-campus"),studentFacultyAttr=checkbox.getAttribute("data-student-faculty"),studentMajorAttr=checkbox.getAttribute("data-student-major"),studentLangAttr=checkbox.getAttribute("data-student-lang");var courseTemplateKey="course_"+checkbox.getAttribute("data-courseid")+"_"+studentLangAttr+"_"+student_idnumber,campusTemplateKey=studentCampusAttr+"_"+studentLangAttr+"_"+student_idnumber,facTemplateKey=studentCampusAttr+"_"+studentFacultyAttr+"_"+studentLangAttr+"_"+student_idnumber,deptTemplateKey=studentCampusAttr+"_"+studentFacultyAttr+"_"+studentMajorAttr+"_"+studentLangAttr+"_"+student_idnumber,templateEmailContent="",templateEmailSubject="";templateCache.has(campusTemplateKey)?(templateEmailSubject=templateCache.get(campusTemplateKey).subject,templateEmailContent=templateCache.get(campusTemplateKey).message,templateObj=templateCache.get(campusTemplateKey)):templateCache.has(facTemplateKey)?templateCache.has(deptTemplateKey)?(templateEmailSubject=templateCache.get(deptTemplateKey).subject,templateEmailContent=templateCache.get(deptTemplateKey).message,templateObj=templateCache.get(deptTemplateKey)):(templateEmailSubject=templateCache.get(facTemplateKey).subject,templateEmailContent=templateCache.get(facTemplateKey).message,templateObj=templateCache.get(facTemplateKey)):templateCache.has(deptTemplateKey)?(templateEmailSubject=templateCache.get(deptTemplateKey).subject,templateEmailContent=templateCache.get(deptTemplateKey).message,templateObj=templateCache.get(deptTemplateKey)):templateCache.has(courseTemplateKey)?(templateEmailSubject=templateCache.get(courseTemplateKey).subject,templateEmailContent=templateCache.get(courseTemplateKey).message,templateObj=templateCache.get(courseTemplateKey)):(templateEmailSubject="Template not found",templateEmailContent="Template not found")}else console.log("couldn't find checkbox");var assignment_title=templateCache.get("assignment_title")||"",params={studentname:student_name_arr,assignmentgrade:assigngrade,assignmenttitle:assignment_title,coursename:templateCache.get("course_name"),customgrade:selected_grade||"D+",defaultgrade:"D+",custommessage:custom_message},changedTemplateEmailContent=addUserInfo(templateEmailContent,params);changedTemplateEmailContent.includes("[custommessage]")&&(changedTemplateEmailContent=changedTemplateEmailContent.replace("[custommessage]",custom_message||"")),record_data.student_id=student_id,record_data.student_name=student_name,record_data.course_name=templateCache.get("course_name"),record_data.templateEmailSubject=templateEmailSubject,record_data.templateEmailContent=changedTemplateEmailContent,record_data.template_id=templateObj.templateid,record_data.revision_id=templateObj.revision_id,record_data.triggered_from_user_id=templateObj.triggered_from_user_id,record_data.target_user_id=student_id,record_data.course_id=templateObj.course_id,record_data.instructor_id=templateObj.instructor_id,record_data.assignment_name=params.assignmenttitle,record_data.actual_grade=assigngrade,record_data.trigger_grade=selected_grade_value,record_data.custom_message=custom_message,"assign"!==alert_type&&button.addEventListener("click",(function(){setup_preview_buttons_from_template(record_data)})),student_template_cache_array.push(record_data)})),setup_send_emails(student_template_cache_array)}function setup_preview_emails_with_titles(templateCache){const alert_type=document.getElementById("early-alert-alert-type").value,customMessage=templateCache.get("custom_message")||"";let student_template_cache_array=[];document.querySelectorAll(".early-alert-preview-button").forEach((button=>{const clone=button.cloneNode(!0);button.parentNode.replaceChild(clone,button)}));document.querySelectorAll(".early-alert-preview-button").forEach((function(button){let record_data={};const checkbox=button.closest("tr").querySelector(".early-alert-student-checkbox"),assigngrade=button.closest("tr").querySelector(".early-alert-grade-column").querySelector(".badge").innerHTML;let selected_grade="",selected_grade_value=0;if("grade"===alert_type){const grade_select=document.getElementById("id_early_alert_filter_grade_select")||{};selected_grade=grade_select.options[grade_select.selectedIndex].text,selected_grade_value=grade_select.value}let templateObj={};if(checkbox){const student_lname_fname=checkbox.parentNode.nextElementSibling.firstChild;var student_name_arr=[],student_name="";student_lname_fname.data.split(/\s*,\s*/).forEach((function(me){student_name_arr.push(me)})),student_name=student_name_arr[1]+" "+student_name_arr[0];var student_id=checkbox.getAttribute("data-student-id"),student_idnumber=checkbox.getAttribute("data-student-idnumber");const studentCampusAttr=checkbox.getAttribute("data-student-campus"),studentFacultyAttr=checkbox.getAttribute("data-student-faculty"),studentMajorAttr=checkbox.getAttribute("data-student-major"),studentLangAttr=checkbox.getAttribute("data-student-lang");var courseTemplateKey="course_"+checkbox.getAttribute("data-courseid")+"_"+studentLangAttr+"_"+student_idnumber,campusTemplateKey=studentCampusAttr+"_"+studentLangAttr+"_"+student_idnumber,facTemplateKey=studentCampusAttr+"_"+studentFacultyAttr+"_"+studentLangAttr+"_"+student_idnumber,deptTemplateKey=studentCampusAttr+"_"+studentFacultyAttr+"_"+studentMajorAttr+"_"+studentLangAttr+"_"+student_idnumber,templateEmailContent="",templateEmailSubject="";templateCache.has(campusTemplateKey)?(templateEmailSubject=templateCache.get(campusTemplateKey).subject,templateEmailContent=templateCache.get(campusTemplateKey).message,templateObj=templateCache.get(campusTemplateKey)):templateCache.has(facTemplateKey)?templateCache.has(deptTemplateKey)?(templateEmailSubject=templateCache.get(deptTemplateKey).subject,templateEmailContent=templateCache.get(deptTemplateKey).message,templateObj=templateCache.get(deptTemplateKey)):(templateEmailSubject=templateCache.get(facTemplateKey).subject,templateEmailContent=templateCache.get(facTemplateKey).message,templateObj=templateCache.get(facTemplateKey)):templateCache.has(deptTemplateKey)?(templateEmailSubject=templateCache.get(deptTemplateKey).subject,templateEmailContent=templateCache.get(deptTemplateKey).message,templateObj=templateCache.get(deptTemplateKey)):templateCache.has(courseTemplateKey)?(templateEmailSubject=templateCache.get(courseTemplateKey).subject,templateEmailContent=templateCache.get(courseTemplateKey).message,templateObj=templateCache.get(courseTemplateKey)):(templateEmailSubject="Template not found",templateEmailContent="Template not found")}var assignment_title=templateCache.get("assignment_title")||"",params={studentname:student_name_arr,assignmentgrade:assigngrade,assignmenttitle:assignment_title,coursename:templateCache.get("course_name"),customgrade:selected_grade||"D+",defaultgrade:"D+",custommessage:customMessage},changedTemplateEmailContent=addUserInfo(templateEmailContent,params);changedTemplateEmailContent.includes("[custommessage]")&&(changedTemplateEmailContent=changedTemplateEmailContent.replace("[custommessage]",customMessage||"")),record_data.student_id=student_id,record_data.student_name=student_name,record_data.course_name=templateCache.get("course_name"),record_data.templateEmailSubject=templateEmailSubject,record_data.templateEmailContent=changedTemplateEmailContent,record_data.template_id=templateObj.templateid,record_data.revision_id=templateObj.revision_id,record_data.triggered_from_user_id=templateObj.triggered_from_user_id,record_data.target_user_id=student_id,record_data.course_id=templateObj.course_id,record_data.instructor_id=templateObj.instructor_id,record_data.assignment_name=params.assignmenttitle,record_data.actual_grade=assigngrade,record_data.trigger_grade=selected_grade_value,record_data.custom_message=customMessage,button.addEventListener("click",(function(){setup_preview_buttons_from_template(record_data)})),student_template_cache_array.push(record_data)})),setup_send_emails(student_template_cache_array)}_exports.init=()=>{document.addEventListener("click",(function(event){if(event.target.classList.contains("early-alert-type-button")){let alert_type=event.target.getAttribute("data-link"),course_name=event.target.getAttribute("data-name"),course_id=event.target.getAttribute("data-course_id"),teacher_user_id=document.getElementById("early-alert-teacher-user-id").value;const default_grade_letter_id="grade"===alert_type?9:-1;console.log("Alert type selected: "+alert_type+" for course: "+course_name+" ("+course_id+")"),setup_filter_students_by_grade(course_id,default_grade_letter_id,course_name,alert_type,teacher_user_id)}})),function(){const params=new URLSearchParams(window.location.search);let user_id=params.get("user_id");if(!user_id){const teacherUserIdInput=document.getElementById("early-alert-teacher-user-id");teacherUserIdInput&&(user_id=teacherUserIdInput.value)}_select_box.default.init("#search","earlyalert_get_users","Select a user"),_select_course_box.default.init("#course-search","earlyalert_get_courses",user_id,"Select a course");let search=document.getElementById("search"),courseSearch=document.getElementById("course-search");search&&search.value;courseSearch.addEventListener("change",(function(event){const courseId=courseSearch.value;courseId&&(window.location.href=_config.default.wwwroot+"/local/earlyalert/dashboard.php?user_id="+user_id+"&course_id="+courseId)})),search&&courseSearch&&search.addEventListener("change",(function(event){const newUserId=search.value;_select_course_box.default.init("#course-search","earlyalert_get_courses",newUserId,"Select a course"),courseSearch.value=""}));const course_id=params.get("course_id");if(course_id&&courseSearch){const setSelectedCourse=()=>{courseSearch.options.length>1?courseSearch.value=course_id:setTimeout(setSelectedCourse,50)};setSelectedCourse()}}(),setup_custom_message_listener(),setup_custom_message_toggles()};function setup_preview_buttons_from_template(student_template_data){_modal_factory.default.create({title:(0,_str.get_string)("preview_email","local_earlyalert"),type:_modal_factory.default.types.CANCEL,body:_templates.default.render("local_earlyalert/preview_student_email",{name:student_template_data.template_name,student_name:student_template_data.student_name,subject:student_template_data.templateEmailSubject,message:student_template_data.templateEmailContent,instructor_name:""}),large:!0}).done((modal=>(modal.show(),modal)))}function setup_send_emails(student_template_cache_array){const send_button=document.getElementById("early-alert-send-button1"),send_button2=document.getElementById("early-alert-send-button2");if(send_button){const new_send_button=send_button.cloneNode(!0);send_button.parentNode.replaceChild(new_send_button,send_button),new_send_button.addEventListener("click",(function(){maintain_student_template_data_for_submit(student_template_cache_array,!0)}))}if(send_button2){const new_send_button2=send_button2.cloneNode(!0);send_button2.parentNode.replaceChild(new_send_button2,send_button2),new_send_button2.addEventListener("click",(function(){maintain_student_template_data_for_submit(student_template_cache_array,!0)}))}}function maintain_student_template_data_for_submit(student_template_cache_array){let forceRebuild=arguments.length>1&&void 0!==arguments[1]&&arguments[1];check_individual_students_checkboxes_for_submit();var student_ids_array=JSON.parse(document.getElementById("early-alert-student-ids").value);let filtered_array=[];if(forceRebuild){document.querySelectorAll("input[class^='early-alert-student-checkbox']").forEach((function(checkbox){if(checkbox.checked){const student_id=checkbox.getAttribute("data-student-id"),record=student_template_cache_array.find((stu=>stu.student_id==student_id));record&&filtered_array.push(record)}}))}else filtered_array=student_template_cache_array.filter((student=>student_ids_array.includes(student.student_id)));filtered_array.length>0?create_notification_dialog(filtered_array):_notification.default.alert("No students selected","Please select at least one student to send emails.")}function create_notification_dialog(student_template_cache_array){var send_string=(0,_str.get_string)("send_email","local_earlyalert"),send_dialog_text=(0,_str.get_string)("send_dialog_text","local_earlyalert"),send=(0,_str.get_string)("send","local_earlyalert"),cancel=(0,_str.get_string)("cancel","local_earlyalert"),could_not_send_email=(0,_str.get_string)("could_not_send_email","local_earlyalert");(0,_str.get_string)("sent_dialog_text","local_earlyalert");_notification.default.confirm(send_string,send_dialog_text,send,cancel,(function(){var sendEmail=_ajax.default.call([{methodname:"earlyalert_report_log_insert",args:{template_data:JSON.stringify(student_template_cache_array)}}]);sendEmail[0].done((function(){sendEmail[0].then((result=>{_notification.default.alert("Email",(0,_str.get_string)("sent_dialog_text","local_earlyalert",result))}))})).fail((function(){_notification.default.alert(could_not_send_email)}))}))}function addUserInfo(emailText,params){const textReplace=["[firstname]","[fullname]","[usergrade]","[grade]","[coursetitle]","[assignmenttitle]","[custommessage]"];let uniqueMatches={};for(let i=0;i<textReplace.length;i++)if(emailText.includes(textReplace[i]))switch(i){case 0:let firstNameText=params.studentname[1]?params.studentname[1]:"{USER_NOT_FOUND}";uniqueMatches[i]=firstNameText;break;case 1:let targetUser=params.studentname[1]?"".concat(params.studentname[1]," ").concat(params.studentname[0]):"{USER_NOT_FOUND}";uniqueMatches[i]=targetUser;break;case 2:let userGradeText=params.assignmentgrade||"{USER GRADE NOT PROVIDED/FOUND}";uniqueMatches[i]=userGradeText;break;case 3:let defaultGradeText=params.customgrade||(params.defaultgrade?params.defaultgrade:"{GRADE NOT PROVIDED/FOUND}");uniqueMatches[i]=defaultGradeText;break;case 4:let courseTitleText=params.coursename||"{COURSE TITLE NOT FOUND}";uniqueMatches[i]=courseTitleText;break;case 5:let assignmentTitleText=params.assignmenttitle||"{ASSIGNMENT TITLE NOT FOUND}";uniqueMatches[i]=assignmentTitleText;break;case 6:let customMessageText=params.custommessage||"";uniqueMatches[i]=customMessageText}for(let i=0;i<textReplace.length;i++)uniqueMatches[i]&&(emailText=emailText.replace(textReplace[i],uniqueMatches[i]));return emailText}function focusOnCheckall(){setTimeout((()=>{const check_all_none_checkbox=document.getElementById("early-alert-checkall-student-checkbox");check_all_none_checkbox&&(check_all_none_checkbox.scrollIntoView({behavior:"smooth",block:"center"}),check_all_none_checkbox.focus())}),100)}function setup_custom_message_toggles(){const btn=document.getElementById("toggle-custom-message"),container=document.getElementById("custom-message-container");if(!btn||!container)return;const button=btn.cloneNode(!0);btn.parentNode.replaceChild(button,btn);const setOpenState=open=>{button.setAttribute("aria-expanded",String(open)),open?(button.innerHTML='<i class="fa fa-minus"></i> Hide Custom Message',button.classList.remove("btn-outline-secondary"),button.classList.add("btn-outline-primary")):(button.innerHTML='<i class="fa fa-plus"></i> Show Custom Message',button.classList.remove("btn-outline-primary"),button.classList.add("btn-outline-secondary"))};container.classList.contains("collapse")||container.classList.add("collapse"),setOpenState(container.classList.contains("show")),button.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation();const willOpen=!container.classList.contains("show");container.classList.toggle("show",willOpen),setOpenState(willOpen),willOpen&&setTimeout((()=>{const ta=container.querySelector(".early-alert-custom-message");ta&&ta.focus()}),0)})),button.addEventListener("mouseenter",(()=>{container.classList.contains("show")?(button.classList.add("btn-primary"),button.classList.remove("btn-outline-primary")):(button.classList.add("btn-secondary"),button.classList.remove("btn-outline-secondary"))})),button.addEventListener("mouseleave",(()=>{container.classList.contains("show")?(button.classList.remove("btn-primary"),button.classList.add("btn-outline-primary")):(button.classList.remove("btn-secondary"),button.classList.add("btn-outline-secondary"))}))}}));

//# sourceMappingURL=filter_students_grade.min.js.map